"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[3431],{10667:(e,t,i)=>{i.d(t,{x:()=>l});i(47010);var n=i(57361),s=i(14041),o=i(79824),r=i(37884),a=i(60899);const l=({nullishXGpuEntitlementIsTruthy:e=!1}={})=>{const t=(0,o.useSelector)(a.NP),[,i]=(0,r.i)(),l=(0,s.useMemo)((()=>{let s;const o=(0,n.getDataOrPrevious)(t);return s=!0===o?t:!1===o?i:(0,n.lceTransform)((0,n.lceMerge)(i,t),(([t,i])=>e?!(!t&&null!=t&&!i):!(!t&&!i))),s}),[t,i,e]);return(0,n.useLce)(l)}},31622:(e,t,i)=>{i.d(t,{r:()=>l});i(10865),i(81045),i(84915),i(47010);var n,s=i(56188),o=i(70622),r=i(84048),a=i(74687);!function(e){e[e.Verbose=0]="Verbose",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(n||(n={}));class l{constructor(e,t){this.subTag=t,this.tag=`GameStreamingSDK${e?`|${e}`:""}: `}static get Instance(){return this.instance||(this.instance=new l("")),this.instance}static setConsoleLogging(e){this.consoleLoggingEnabled=e}static isConsoleLoggingAllowed(){return this.consoleLoggingEnabled}static async getLogs(){try{return l.logHandler&&(0,r.k)(l.logHandler)?await l.logHandler.getCurrentLogArray():(l.Instance.warning("No StreamClientLogHandler found to get logs"),["No StreamClientLogHandler found to get logs"])}catch(e){return l.Instance.error("Failed to retrieve GameStream logs",e),["Failed to retrieve GameStream logs"]}}log(e,...t){var i;if(!l.isConsoleLoggingAllowed())return;const s=t.map((e=>(0,a.A)(e))),o=`${this.tag}${null!==(i=this.subTag)&&void 0!==i?i:""}${s}`;switch(e){case n.Verbose:console.debug(o);break;case n.Info:console.log(o);break;case n.Warning:console.warn(o);break;case n.Error:console.error(o)}}verbose(...e){var t;this.log(n.Verbose,...e),null===(t=l.logHandler)||void 0===t||t.onVerbose(this.tag,...e)}info(...e){var t;this.log(n.Info,...e),null===(t=l.logHandler)||void 0===t||t.onInfo(this.tag,...e)}warning(...e){var t;this.log(n.Warning,...e),o.H.Instance.trackEvent({event:o.X.SdkWarning,message:(0,a.A)(e)}),null===(t=l.logHandler)||void 0===t||t.onWarning(this.tag,...e)}error(...e){var t;this.log(n.Error,...e),o.H.Instance.trackEvent({event:o.X.SdkError,message:e.map(a.A).join("; ")}),null===(t=l.logHandler)||void 0===t||t.onError(this.tag,...e)}throw(e,t){const i=new s.F(e,t);throw this.error(i),i}reject(e,t,i){const n=new s.F(e,t);this.error(n),i(n)}rejectWithError(e,t){this.error(e),t(e)}rejectWithWarning(e,t,i){this.warning(e);i(new s.F(e,t))}}l.consoleLoggingEnabled=!0},34041:(e,t,i)=>{i.d(t,{FI:()=>l,K$:()=>a,ul:()=>r});var n=i(57361),s=i(78911),o=i(69607);function r(e){var t;return null!==(t=(0,o.UI)(e)[s.pA])&&void 0!==t?t:n.LCE_NOT_REQUESTED}function a(e){return(0,n.getDataOrPrevious)(r(e))}function l(e){var t;return null===(t=(0,n.getDataOrPrevious)(r(e)))||void 0===t||null===(t=t.sessionRequest)||void 0===t||null===(t=t.titleInfo)||void 0===t?void 0:t.details.productId}},37837:(e,t,i)=>{i.d(t,{g:()=>s});i(97107),i(10568);var n=i(74687);function s(e){if(e instanceof Error)return e;if(null==e)return new Error("Unknown error");if("string"===typeof e.name&&"string"===typeof e.message)return e;if("string"===typeof e)return new Error(e);try{return new Error((0,n.A)(e))}catch(t){return new Error(e.toString()||"Unknown error")}}},37884:(e,t,i)=>{i.d(t,{i:()=>l});var n=i(57361),s=i(50201),o=i(87309),r=i(15387),a=i(53649);const l=()=>{const e=(0,r.G_)(o.H.OverrideIsXGPUSubscriber),t=(0,a.yu)(s.CZ),i=(0,n.useLce)((0,n.lceContent)(!!e));return null!=e?i:t}},43245:(e,t,i)=>{var n,s,o,r,a,l;i.d(t,{EO:()=>o,RS:()=>r,Tu:()=>a,g$:()=>s,if:()=>l,kc:()=>n}),function(e){e[e.Excellent=0]="Excellent",e[e.Good=1]="Good",e[e.Ok=2]="Ok",e[e.Poor=3]="Poor",e[e.Unknown=4]="Unknown"}(n||(n={})),function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting"}(s||(s={})),function(e){e.Requested="Requested",e.Enabled="Enabled",e.Muted="Muted",e.NotAllowed="NotAllowed",e.NotFound="NotFound"}(o||(o={})),function(e){e.ConnectingFailed="ConnectingFailed",e.CleanDisconnect="CleanDisconnect",e.CleanShutdown="CleanShutdown",e.TransportError="TransportError",e.ServerKickByNewSession="KickByNewSession",e.ServerKickForClosedGame="KickForClosedGame",e.ServerKickForBeingIdle="KickForBeingIdle",e.ServerKickForSignOut="KickForSignOut",e.ServerKickForServerShutdown="KickForServerShutdown",e.ServerKickForStopCommand="KickForStopCommand",e.ServerKickForAppError="KickForAppError",e.ServerKickForNoClientConnection="KickForNoClientConnection",e.ServerKickForOutOfStreamingTime="KickForOutOfStreamingTime",e.BrowserUnsupported="BrowserUnsupported"}(r||(r={})),function(e){e.Cloud="Cloud",e.Direct="Direct",e.Home="Home",e.ManagedDevkit="ManagedDevkit"}(a||(a={})),function(e){e[e.Invite=0]="Invite",e[e.Join=1]="Join",e[e.TitleActivation=2]="TitleActivation"}(l||(l={}))},44552:(e,t,i)=>{i.d(t,{$E:()=>L,A:()=>D,Ad:()=>F,Bq:()=>a,Cw:()=>z,DV:()=>h,Dp:()=>B,Dw:()=>Q,EE:()=>f,JZ:()=>S,K8:()=>O,KW:()=>I,Mj:()=>l,My:()=>H,Nr:()=>W,PU:()=>ee,Pz:()=>b,Q$:()=>P,Qm:()=>_,R2:()=>X,R7:()=>u,RE:()=>R,RY:()=>M,Tk:()=>N,Ux:()=>J,VB:()=>v,Vy:()=>j,Yo:()=>s,Yx:()=>q,Zz:()=>c,_C:()=>Y,_b:()=>p,_j:()=>r,bH:()=>y,c9:()=>x,dF:()=>k,eA:()=>T,ec:()=>A,fb:()=>V,g_:()=>m,ib:()=>o,kM:()=>g,lL:()=>$,nX:()=>C,sN:()=>E,vO:()=>w,vj:()=>G,w3:()=>U,xl:()=>d,yH:()=>Z,zu:()=>n});i(98376),i(46929),i(81045),i(45950);function n(e="en-us"){return`https://privacy.microsoft.com/${e}/privacystatement`}function s(e="en-us"){return`${a}/${e}/xbox-game-pass/cloud-gaming`}const o="https://aka.ms/webpreview",r="https://account.microsoft.com/services/",a="https://www.xbox.com",l="https://www.xbox.com/play",c="https://aka.ms/cloud-gaming/supported-browsers",d="https://aka.ms/xboxprivacysettings",h="https://aka.ms/cloud-gaming/supported-controllers",u="https://support.xbox.com/help/hardware-network/controller/connect-xbox-wireless-controller-to-pc",g="https://aka.ms/cloud-gaming/touch-controls/screen-too-small",m="https://redeem.microsoft.com",p="https://support.xbox.com/help/family-online-safety/online-safety/photosensitive-seizure-warning",S="https://www.xbox.com/regions",v="https://support.xbox.com/help/games-apps/cloud-gaming/guide-to-cloud-gaming",f="https://aka.ms/XboxA11y";const y="https://www.xbox.com/legal/community-standards",w="https://www.xbox.com/xbox-game-pass",C="https://go.microsoft.com/fwlink/?LinkId=521839",T="https://aka.ms/privacy",b="https://go.microsoft.com/fwlink/?LinkID=206977",I="https://www.xbox.com/legal/legal-notices",k="https://www.xbox.com/smart-tv-help",A="https://xbox.com/smart-tv-pair",P="https://xbox.com/buycontroller",E="https://www.xbox.com/gptv",x="https://www.xbox.com/gptv1",M="https://www.xbox.com/gptv2",D="https://www.xbox.com/gptv3",R="https://www.xbox.com/gptv4",F="https://support.xbox.com/help/family-online-safety/online-safety/manage-online-safety-and-privacy-settings-xbox-one",L="https://aka.ms/xcloudforum",N="https://aka.ms/xboxenforcement",U="https://aka.ms/xcgbuycontroller",$="https://aka.ms/YourCaliforniaPrivacyChoices",V="https://www.xbox.com/apps/xbox-app-for-mobile",B="https://aka.ms/XboxFamilyInfo",O="http://aka.ms/XboxFamilyApp",H="https://aka.ms/GamertagChange",G="https://aka.ms/GamertagHelp",K=[{regex:/^https:\/\/account\.xbox\.com\/.*\/settings\?rtc=1&activetab=main%3aprivacytab/i,shortUrl:"https://aka.ms/xbox-privacy"},{regex:/^https:\/\/support\.xbox\.com\/help\/family-online-safety\/online-safety\/photosensitive-seizure-warning/i,shortUrl:"https://aka.ms/xbox-pssw"},{regex:/^https:\/\/www\.xbox\.com\/.*\/legal\/legal-notices/i,shortUrl:"https://aka.ms/xbox-tpn"},{regex:/^https:\/\/www\.xbox\.com\/legal\/community-standards/i,shortUrl:"https://aka.ms/xbox-cs"},{regex:/^https:\/\/www\.microsoft\.com\/.*\/store.*\/terms-of-sale/i,shortUrl:"https://aka.ms/xbox-tos"},{regex:/^https?:\/\/www\.xbox\.com\/.*\/legal\/codeofconduct/i,shortUrl:"https://aka.ms/xbox-coc"}],q="http://tizen.org/feature/network.bluetooth",X="http://tizen.org/appcontrol/operation/default";function _(e){var t;const i=K.find((t=>null===t||void 0===t?void 0:t.regex.test(e)));return null!==(t=null===i||void 0===i?void 0:i.shortUrl)&&void 0!==t?t:e}const W="https://aka.ms/usercontentmanagement",z="https://aka.ms/ucm360support",Y="https://social.xbox.com/changegamertag",j="https://aka.ms/accsSetup",J="https://aka.ms/fire-stick-setup",Q="https://aka.ms/FrenchDecreeLink",Z="https://aka.ms/caccssetup",ee="https://support.xbox.com/help/games-apps/game-setup-and-play/how-to-set-up-remote-play"},51879:(e,t,i)=>{i.r(t),i.d(t,{AudioMode:()=>y.w,AuthRoutingService:()=>v,AuthenticationClient:()=>se,CloudStreamSessionRequest:()=>It,ComputedStreamStatistic:()=>F,ConsolePowerState:()=>q,CorrelationVector:()=>w.W,CursorStyle:()=>C.SE,EndpointSettings:()=>he,GameInviteType:()=>rt.if,GameStreamError:()=>a.F,GameStreamErrorCode:()=>l.ws,GamepadButtonId:()=>C.t,GamepadInputPhysicality:()=>N.J,GamepadMappingAxisCount:()=>C.Sl,GamepadMappingButtonCount:()=>C.TZ,GsServicesErrorDetailsErrorInterceptor:()=>Z,GsServicesErrorDetailsResponseInterceptor:()=>Q,HighContrastMode:()=>X,HomeConsoleStreamSessionRequest:()=>kt,HttpEnvironment:()=>oe,InputMessageTypeFlags:()=>C.$B,InputPollingType:()=>C.mb,ManagedDevkitStreamSessionRequest:()=>At,ManagedDevkitStreamUser:()=>S,MessageModalOptions:()=>ze,MicrophoneState:()=>rt.EO,MouseButtonBrowserId:()=>C.RE,MouseButtonIndex:()=>C.sl,MouseReadingType:()=>C.W8,NetworkQualityIndicatorType:()=>di.L,ReleaseChannel:()=>me,ScanCodeToHidMap:()=>C.pu,SdkTelemetryEvents:()=>d.X,SensorAccuracy:()=>C.WT,ServerAllocationPollingConfiguration:()=>k,StateDiscriminator:()=>C.yB,StreamClient:()=>_t,StreamClientLogHandler:()=>Mt,StreamLogger:()=>c.r,StreamSession:()=>at,StreamSessionConnectionState:()=>rt.g$,StreamSessionConnectionType:()=>rt.Tu,StreamSessionDisconnectReason:()=>rt.RS,StreamSessionQualityLevel:()=>rt.kc,StreamSessionRequest:()=>Tt,StreamSessionRequestInternal:()=>bt,StreamSessionRequestState:()=>Ct,StreamStatistics:()=>L,StreamType:()=>x.P,StreamUser:()=>m,StreamUserType:()=>f,StreamingRegion:()=>g,SupportedInputTypeEnum:()=>Wt,SystemUiType:()=>_e,TitleManager:()=>Xt,TitleState:()=>fe,UnreliableGamepadFrame:()=>C.yy,UnreliableInputFrame:()=>C.Fg,UnreliableInputFrameTracker:()=>C.NP,UnreliableKeyboardFrame:()=>C.Yu,UnreliableKeyboardFrameTracker:()=>C.Cv,UnreliableMouseFrame:()=>C.ot,UnreliablePointerFrame:()=>C.qb,UnreliablePointerStateType:()=>C.Qs,UserContentType:()=>_,VibrationType:()=>C.VU,VirtualKeyboardInputScope:()=>We,WheelEventDeltaMode:()=>C.pY,XCloudStreamUser:()=>p,areRectsEqual:()=>V,blankGamepadMapping:()=>C.iz,blankSensorReading:()=>C.Lh,calculateGamepadPhysicality:()=>N.Z,getAudioModeString:()=>ue,getModernizr:()=>si,getPerfTrackerProfileString:()=>ve,getProtocolString:()=>ge,getReleaseChannelString:()=>pe,getStreamTypeString:()=>Se,isFeatureSupported:()=>li,isGamepadTitle:()=>jt,isMouseAndKeyboardTitle:()=>Qt,isNativeSensorsTitle:()=>ei,isNativeTouchTitle:()=>Jt,isPersistentHandler:()=>ye.k,isStateSharePrototypeData:()=>Pt,isSupportedTabsTitle:()=>Zt,mergeStreamSessionConfigurations:()=>mt,sanitizeConfigurationForTelemetry:()=>pt,serviceConfigurationPropertyBlocklist:()=>ut,supportedFeatureTestKeys:()=>ii,trackMediaSourceSupport:()=>ai,trackUnsupportedFeatures:()=>ri,validateAudioConfiguration:()=>y.F,validateClientStreamingConfigOverrides:()=>vt,validateInputConfiguration:()=>I,validateStatisticsConfiguration:()=>P,validateVideoConfiguration:()=>O});var n=i(41506),s=i.n(n),o=(i(97107),i(69375),i(33975),i(64727),i(10865),i(47748),i(81045),i(45950),i(5350),i(47010),i(90692)),r=i(28985);var a=i(56188),l=i(76753),c=i(31622),d=i(70622),h=i(37837),u=i(74687);class g{constructor(e,t,i,n,s){this.friendlyName=e,this.domain=t,this.networkTestEndpoint=i,this.systemUpdateGroups=null!==s&&void 0!==s?s:[],this.user=n,""!==this.systemUpdateGroups[0]&&this.systemUpdateGroups.unshift("")}}class m extends r.EventEmitter{constructor(e,t,i,n){super(),this.lastRefreshScheduleTime=0,this.instanceId=++m.instances,this.networkTestEndpoint="",this.regions=[],this.fallbackRegionNames=[],this.market="",this.identity=e,this.cv=i.extend(),this.endpointSettings=n,"string"===typeof t?this.offeringId=t:(this.offeringId=t.id,this.endpointSettings.setDomain(t.fqdn)),this.logger=new c.r("StreamUser",`(${this.instanceId})`),this.telemetry=d.H.Instance}setStreamingRegion(e){e.user!==this&&this.logger.throw("The region has to be for this user - not somebody else",l.ws.InvalidArgument),this.endpointSettings.setDomain(e.domain),this.networkTestEndpoint=e.networkTestEndpoint,this.currentRegion=e}validateSystemUpdateGroup(e){return this.currentRegion&&this.currentRegion.systemUpdateGroups.includes(e)?(this.logger.info(`StreamSessionRequest: Using system update group ${e}.`),e):(this.logger.warning(`StreamSessionRequest: System update group ${e} not found, using default.`),"")}async updateIdentity(e){const{token:t}=this.identity;this.identity=s()(s()({},this.identity),e),this.identity.token&&t!==this.identity.token&&await this.refresh()}cancelScheduledTokenRefresh(){this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0)}scheduleTokenRefresh(e){{const t=Date.now(),i=3e5,n=t-this.lastRefreshScheduleTime;n<i&&(e=i,this.logger.info(`Auth: gstoken refresh last attempted only ${n/1e3} seconds ago, throttling.`)),this.lastRefreshScheduleTime=t,this.logger.info(`Auth: set gstoken refresh timer for ${e/1e3} seconds from now`),this.cancelScheduledTokenRefresh(),this.timerId=setTimeout((()=>{this.refresh()}),e)}}async refresh(){this.logger.info("Auth: refreshing gstoken");const e=Date.now();let t,i=!1;try{await this.updateToken(),i=!0,this.logger.info("Auth: gstoken refreshed")}catch(n){const e=(0,h.g)(n);if(this.logger.error(`Auth: User gstoken refresh failed: ${(0,u.A)(e)}`),e instanceof a.F)switch(e.code){case l.ws.AuthUnauthorized:case l.ws.AuthExpiredToken:case l.ws.AuthBadToken:{this.logger.error(`Auth: User gstoken refresh failed ${e.code}, firing UserTokenInvalidated event`);const t={reason:e.code};this.invokeTokenInvalidated(t);break}default:this.logger.error(`Auth: User gstoken refresh failed ${e.code}, retrying in 60 seconds`),t=6e4}else e instanceof o.HttpError?(this.logger.error(`Auth: User gstoken refresh failed ${e.response.status}, retrying in 60 seconds`),t=6e4):(this.logger.info(`Auth: User gstoken refresh failed ${e.message}, retrying in 30 seconds`),t=3e4)}t&&this.scheduleTokenRefresh(t),this.telemetry.trackEvent({event:d.X.AuthUserTokenRefreshed,cV:this.cv.getValue(),latencyMs:Date.now()-e,success:i})}invokeTokenInvalidated(e){this.emit("identityTokenInvalidated",{args:e,sender:this})}}m.instances=0;class p extends m{static deserialize(e,t,i,n,s,o){const r=JSON.parse(e),a=new p(t,i,n,s,o);return a.hydrate(r),a}constructor(e,t,i,n,s){super(e,i,n,s),this.authClient=t}serialize(){if(this.hydratableUserAuthResponse)return JSON.stringify(this.hydratableUserAuthResponse);this.logger.warning("Attempted to serialize a StreamUser which hasn't been authenticated yet")}applyHydratableUserString(e){this.hydrate(JSON.parse(e))}hasToken(){return!!this.gsToken}getToken(){return Promise.resolve(this.gsToken)}getAuthorizationHeader(){return Promise.resolve(this.hasToken()?`Bearer ${this.gsToken}`:"")}async updateToken(){if(this.cv.increment(),this.logger.info(`Updating gs token cv: ${this.cv.getValue()}`),this.identity.expires){new Date(this.identity.expires).getTime()<Date.now()&&this.logger.throw("User token has expired",l.ws.AuthExpiredToken)}this.identity.token||this.logger.throw("User token cannot be empty",l.ws.AuthBadToken);const e={token:this.identity.token,offeringId:this.offeringId},[t]=await this.authClient.loginUser(this,e);this.hydratableUserAuthResponse=t,this.hydrate(this.hydratableUserAuthResponse)}hydrate(e){let t=e.durationInSeconds;if(e.retrievedAtTimestamp){const i=Math.max(0,Date.now()-e.retrievedAtTimestamp),n=1e3*e.durationInSeconds;t=Math.floor(Math.max(0,n-i)/1e3)}else this.logger.warning(`Auth response did not include a retrieved timestamp - Falling back to existing duration value of ${t}s`);t<=0&&this.logger.throw("Expired token passed to hydrate",l.ws.AuthExpiredToken),this.logger.info(`Gstoken done, length = ${e.gsToken.length}`);const i=e.offeringSettings.regions,n=new Array;if(e.offeringSettings.allowRegionSelection)i.forEach((e=>{var t;const i=new g(e.name,e.baseUri,e.networkTestHostname,this,null===(t=e.systemUpdateGroups)||void 0===t?void 0:t.slice());e.isDefault?n.unshift(i):n.push(i)}));else{var s;const e=i.find((e=>e.isDefault));e||this.logger.throw("The default region should always be there",l.ws.NotFound),n.push(new g(e.name,e.baseUri,e.networkTestHostname,this,null===(s=e.systemUpdateGroups)||void 0===s?void 0:s.slice()))}const o=new Array;if(i.slice().sort(((e,t)=>e.fallbackPriority-t.fallbackPriority)).forEach((e=>{e.isDefault||-1===e.fallbackPriority||o.push(e.name)})),this.gsToken=e.gsToken,this.regions=n,this.fallbackRegionNames=o,this.market=e.market,this.regions[0]&&this.setStreamingRegion(this.regions[0]),t<300)this.logger.info("Token will expire in less than 5 minutes - scheduling an immediate refresh"),this.scheduleTokenRefresh(0);else{const t=1e3*e.durationInSeconds;this.scheduleTokenRefresh(t/2)}}}class S extends m{constructor(e,t,i,n){super(e,t,i,n)}serialize(){throw new Error("Not implemented")}hasToken(){return!!this.identity.getToken}async getToken(){if(!this.identity.getToken)return;return(await this.identity.getToken()).token}async getAuthorizationHeader(){if(!this.identity.getToken)return"";const e=await this.identity.getToken();return`XBL3.0 x=${(t=e).userHash||0};${t.token}`;var t}updateToken(){return Promise.resolve()}}var v,f;!function(e){e.AzureFrontDoor="AFD",e.AzureTrafficManager="ATM"}(v||(v={})),function(e){e[e.XCloud=0]="XCloud",e[e.ManagedDevkit=1]="ManagedDevkit"}(f||(f={}));var y=i(79406),w=i(90507),C=i(97406),T=i(76203);const b={enableGamepadInput:T.Lm,enableMouseInput:T.Lm,enableAbsoluteMouse:T.Lm,enableKeyboardInput:T.Lm,enableTouchInput:T.Lm,enableExperimentalSensorInput:T.Lm,enableSensorInput:T.Lm,sensorInputPollingRateInHz:T.Bf,enableVibration:T.Lm,useNexusPressWorkaround:T.Lm,useIntervalWorkerThreadForInput:T.Lm,inputChannelMaxVersion:T.Bf,gamepadTransformer:T.Tn,maxTouchPoints:T.Bf,useUnreliableInput:T.Lm,enableClientRenderedCursor:T.Lm},I=(0,T.yy)(b,{name:"validateInputConfiguration",ignoreNullish:!0,throwErrors:!0});class k{constructor(e){this.queuePollingIntervalMs=1e4,this.provisioningPollingIntervalMs=2e3,this.retryPollingIntervalMs=2e3,this.useRetryAfterHeader=!1,this.onRetryAfterUpdate=e=>{if(!this.useRetryAfterHeader)return;if(!e||isNaN(e))throw new Error("Invalid value provided by Retry-After header");const t=1e3*e;this.queuePollingIntervalMs=t,this.provisioningPollingIntervalMs=t},this.useRetryAfterHeader=e}}const A={statsCollectionSizeSec:T.Bf,statsPollingIntervalMs:T.Bf,statsEventFrequencySec:T.Bf,numberOfStatsEventsToStore:T.Bf,stringifyStatUponCollect:T.Lm},P=(0,T.yy)(A,{name:"validateStatisticsConfiguration",ignoreNullish:!0,throwErrors:!0});i(30163),i(73118),i(90374),i(72252),i(38124),i(70889),i(98788),i(46826),i(65949),i(9402),i(84035),i(14419),i(20629),i(90029),i(21019),i(65478),i(55976);var E=i(91211),x=i(59306);const M="requestVideoFrameCallback"in HTMLVideoElement.prototype,D="getVideoPlaybackQuality"in HTMLVideoElement.prototype;var R;!function(e){e.requestAnimationFrame="rAF",e.requestVideoFrameCallback="rVFC",e.getVideoPlaybackQuality="gVPQ",e.unavailable="unavailable"}(R||(R={}));class F{constructor(e){this.processedFPS=0,this.renderedFPS=0,this.timeStamp=0,this.statAsJsonString="",this.streamType=e,this.renderedFPSMethod=M?R.requestVideoFrameCallback:D?R.getVideoPlaybackQuality:R.unavailable}}class L{constructor(e,t,i,n){if(this.intervalMs=0,this.previousVideoPlaybackQualityRenderedFrames=0,this.shouldCollectStats=!1,this.totalStatsCollectedCount=0,this.totalStatsEventsSentCount=0,this.originalLightweightTelemetryState=!1,this.videoStatsCollectionSizeSec=0,this.statsTelemetryEventIntervalSec=0,this.numberOfEventsToStore=1,this.stringifyStatUponCollect=!1,this.lastTelemetryEventEmittedTimestamp=0,this.currentPausedSources=new Set,this.StreamAppVisibilityPauseSourceName="Stream App Visibility",this.collectionBegan=!1,this.mediaElement=null,this.onStreamVisibilityChanged=e=>{e?this.removePause(this.StreamAppVisibilityPauseSourceName):this.addPause(this.StreamAppVisibilityPauseSourceName)},this.onNewAudioVideoStatsAvailable=e=>{if(this.ongoingAudioVideoStatsCollection&&!(this.currentPausedSources.size>0)){if(!this.stream||!this.stream.isStreamActive())return this.logger.info("[Stream Statistics] Stream is no longer active, stopping stats collection."),null!=this.requestVideoFrameCallbackId&&this.mediaElement instanceof HTMLVideoElement&&(this.mediaElement.cancelVideoFrameCallback(this.requestVideoFrameCallbackId),this.requestVideoFrameCallbackId=void 0),this.currentComputedStats=void 0,this.previousVideoFrameMetadata=void 0,this.previousVideoPlaybackQuality=void 0,void(this.previousVideoPlaybackQualityRenderedFrames=0);this.currentComputedStats=this.ongoingAudioVideoStatsCollection.getNextAvailableElem(),this.currentComputedStats.timeStamp=performance.now(),this.currentComputedStats.streamType=this.stream.getStreamType(),this.currentComputedStats.processedFPS=0,this.currentComputedStats.renderedFPS=0,this.collectPlaybackStats(this.currentComputedStats),this.stream.getStreamType()==x.P.WebRTCV1&&(this.currentComputedStats.webRtcQualityMetrics=e),this.totalStatsCollectedCount++,this.stringifyStatUponCollect&&(this.currentComputedStats.statAsJsonString=JSON.stringify(this.currentComputedStats,((e,t)=>{if("statAsJsonString"!=e)return t}))),this.shouldFireMidSessionEvent()&&(this.sendStreamingStatisticsEvent(),1!=this.numberOfEventsToStore&&this.ongoingAudioVideoStatsCollection.reset())}},this.calculateVideoElementPlaybackQualityStats=(e,t,i)=>{t.renderedFPSMethod=R.getVideoPlaybackQuality;const n=null===i||void 0===i?void 0:i.getVideoPlaybackQuality(),s=n.totalVideoFrames-n.droppedVideoFrames;if(this.previousVideoPlaybackQuality&&this.previousVideoPlaybackQualityRenderedFrames){var o;let i;if((null===(o=this.previousVideoPlaybackQuality)||void 0===o?void 0:o.totalVideoFrames)>n.totalVideoFrames){i=s/((e-n.creationTime)/1e3)}else{const e=n.creationTime-this.previousVideoPlaybackQuality.creationTime;i=(s-this.previousVideoPlaybackQualityRenderedFrames)/(e/1e3)}t.renderedFPS=(100*i|0)/100}this.previousVideoPlaybackQuality=n,this.previousVideoPlaybackQualityRenderedFrames=s},this.updateStateOnVideoFrame=(e,t)=>{if(this.requestVideoFrameCallbackId=void 0,this.currentComputedStats&&this.previousVideoFrameMetadata){const e=t.expectedDisplayTime-this.previousVideoFrameMetadata.expectedDisplayTime;let i;i=t.presentedFrames>this.previousVideoFrameMetadata.presentedFrames?t.presentedFrames-this.previousVideoFrameMetadata.presentedFrames:t.presentedFrames;const n=i/(e/1e3);this.currentComputedStats.renderedFPS=(100*n|0)/100}this.previousVideoFrameMetadata=t},this.addPause=e=>{this.logger.info(`[Stream Statistics] New source is pausing collection. Source = ${e}`),this.currentPausedSources.add(e)},this.removePause=e=>{this.currentPausedSources.delete(e)?this.logger.info(`[Stream Statistics] Source = ${e} was released from pausing collection.`):this.logger.info(`[Stream Statistics] Source = ${e} attempted to remove pause, but could not be found in the current list of sources.`),this.currentPausedSources.size>0?(this.logger.info(`[Stream Statistics] ${this.currentPausedSources.size} Pause sources remaining: `),this.currentPausedSources.forEach((e=>{this.logger.info(`[Stream Statistics] -> ${e}`)}))):this.logger.info("[Stream Statistics] collection resuming")},this.stream=e,this.telemetryContext=i,this.cv=n,this.logger=c.r.Instance,this.originalLightweightTelemetryState=d.H.Instance.isLightweightTelemetryEnabled(),d.H.Instance.setEnableLightweightTelemetry(!0),this.finalStatsLists={empty:Object.freeze([])},this.validateStatsConfig(t),t.statsCollectionSizeSec&&t.statsCollectionSizeSec>0){var s,o,r;if(this.videoStatsCollectionSizeSec=t.statsCollectionSizeSec,this.intervalMs=null!==(s=t.statsPollingIntervalMs)&&void 0!==s?s:1e3,t.statsEventFrequencySec&&t.statsEventFrequencySec>0)this.statsTelemetryEventIntervalSec=t.statsEventFrequencySec,this.numberOfEventsToStore=null!==(o=t.numberOfStatsEventsToStore)&&void 0!==o?o:1,this.stringifyStatUponCollect=null!==(r=t.stringifyStatUponCollect)&&void 0!==r&&r;this.shouldCollectStats=!0;const e=1e3*this.videoStatsCollectionSizeSec/this.intervalMs;this.finalStatsLists.filled=Array(e),this.ongoingAudioVideoStatsCollection=new E.CircularBuffer(e),this.ongoingAudioVideoStatsCollection.initialize(new F(this.stream.getStreamType())),this.logger.info("[Stream Statistics] Stats object created.")}else this.shouldCollectStats=!1,this.logger.info("[Stream Statistics] Collection window was not set, so no collection will occur")}validateStatsConfig({statsPollingIntervalMs:e,statsCollectionSizeSec:t,statsEventFrequencySec:i,numberOfStatsEventsToStore:n}){void 0!==e&&e<100&&this.logger.throw("Stats collection interval is not within bounds",l.ws.Bounds),void 0!==t&&(t<0||t>300)&&this.logger.throw("Stats collection window out of bounds",l.ws.Bounds),0!=i&&0===n&&this.logger.throw("Invalid numberOfEventsToStore, cannot be 0 when one or more telemetry events are being sent",l.ws.Bounds),void 0!==i&&void 0!==t&&i>t&&this.logger.throw("Invalid Stats telemetry frequency. statsEventFrequencySec cannot be larger than the statsCollectionSizeSec or it will lead to data loss",l.ws.Bounds),void 0!==n&&1!=n&&i!=t&&this.logger.throw("numberOfEventsToStore != 1, and statsTelemetryEventIntervalSec != videoStatsCollectionSizeSec, which can create duplicate data.",l.ws.Bounds)}startAudioVideoStatsCollection(){var e,t,i,n,s;this.shouldCollectStats?null!==(e=this.stream)&&void 0!==e&&e.isStatsCollectionSupported()?null!==(t=this.stream)&&void 0!==t&&t.isStreamActive()?(this.collectionBegan=!0,this.mediaElement=this.stream.getRenderTarget(),this.lastTelemetryEventEmittedTimestamp<=0&&(this.lastTelemetryEventEmittedTimestamp=performance.now()),this.mediaElement instanceof HTMLVideoElement&&(M?this.requestVideoFrameCallbackId=this.mediaElement.requestVideoFrameCallback(this.updateStateOnVideoFrame):D?this.previousVideoPlaybackQuality=this.mediaElement.getVideoPlaybackQuality():this.logger.warning("renderedFPSMethod is unavailable")),this.currentPausedSources=new Set,null===(i=this.stream)||void 0===i||i.addListener("qualityReportReady",this.onNewAudioVideoStatsAvailable),null===(n=this.stream)||void 0===n||n.addListener("documentVisibilityChanged",this.onStreamVisibilityChanged),null===(s=this.stream)||void 0===s||s.startStreamStatisticsReporting(this.intervalMs),this.logger.info("[Stream Statistics] Successfully registered to collect stats from Stream upon availability")):this.logger.warning("startAudioVideoStatsCollection() was called but stream is not ready yet"):this.logger.warning("startAudioVideoStatsCollection() was called but stream doesn't support Stats collection."):this.logger.warning("startAudioVideoStatsCollection() was called but collection was set to FALSE")}collectPlaybackStats(e){this.mediaElement instanceof HTMLVideoElement?M?(e.renderedFPSMethod=R.requestVideoFrameCallback,null==this.requestVideoFrameCallbackId&&(this.requestVideoFrameCallbackId=this.mediaElement.requestVideoFrameCallback(this.updateStateOnVideoFrame))):D&&this.calculateVideoElementPlaybackQualityStats(e.timeStamp,e,this.mediaElement):this.mediaElement instanceof HTMLCanvasElement&&(e.renderedFPSMethod=R.requestAnimationFrame)}shutdown(){this.ongoingAudioVideoStatsCollection=void 0,this.totalStatsEventsSentCount=0,this.totalStatsCollectedCount=0,this.stream.removeListener("qualityReportReady"),this.stream.removeListener("documentVisibilityChanged"),d.H.Instance.setEnableLightweightTelemetry(this.originalLightweightTelemetryState)}isStatsCollectionSupported(){return this.stream.isStatsCollectionSupported()}shouldFireDisconnectEvent(){return!!this.ongoingAudioVideoStatsCollection}shouldFireMidSessionEvent(){return!!this.ongoingAudioVideoStatsCollection&&(!!this.currentComputedStats&&(this.statsTelemetryEventIntervalSec>0&&(this.currentComputedStats.timeStamp-this.lastTelemetryEventEmittedTimestamp)/1e3>=this.statsTelemetryEventIntervalSec))}getAllCollectedAudioVideoStats(){if(this.shouldCollectStats&&this.finalStatsLists.filled&&this.ongoingAudioVideoStatsCollection){this.finalStatsLists.filled.length=this.ongoingAudioVideoStatsCollection.length;for(let e=0;e<this.ongoingAudioVideoStatsCollection.length&&e<this.finalStatsLists.filled.length;e++)this.finalStatsLists.filled[e]=this.ongoingAudioVideoStatsCollection.getElemAtIndex(e);return this.finalStatsLists.filled}return this.logger.warning("startAudioVideoStatsCollection() was called but stream doesn't support Stats collection."),this.finalStatsLists.empty}concatStringifiedStats(e){let t="[",i=0;for(const n of e)n&&(i>0&&(t+=","),t+=n.statAsJsonString,i++);return t+="]",[t,i]}sendStreamingStatisticsEvent(){const e=this.getAllCollectedAudioVideoStats();let t="",i=0;if(this.stringifyStatUponCollect)[t,i]=this.concatStringifiedStats(e);else{const n=e.filter((e=>!!e));i=n.length,t=JSON.stringify(n)}d.H.Instance.trackEvent(s()({event:d.X.StreamStatistics,order:this.totalStatsEventsSentCount++,currentStatsCount:i,sessionTotalStatsCount:this.totalStatsCollectedCount,numberOfEventsToSave:this.numberOfEventsToStore,statsTelemetryEventIntervalSec:this.statsTelemetryEventIntervalSec,statsCollectionSizeSec:this.videoStatsCollectionSizeSec,storeLastEventOnly:this.numberOfEventsToStore>0,statsSchemaVersion:3,streamType:this.stream.getStreamType(),statistics:t},this.telemetryContext.getProps(this.cv)),!0),this.currentComputedStats&&(this.lastTelemetryEventEmittedTimestamp=this.currentComputedStats.timeStamp)}}var N=i(82361),U=(i(87050),i(29142));const $=(0,T.yy)({left:T.Bf,top:T.Bf,right:T.Bf,bottom:T.Bf},{name:"isPartialRect",ignoreNullish:!0,throwErrors:!0});function V(e,t){return e===t||!(!e||!t||e.left!==t.left||e.top!==t.top||e.right!==t.right||e.bottom!==t.bottom)}const B={showStreamStatisticsOverlay:T.Lm,videoDecoderType:(0,T.y$)(U.RainwayVideoDecoder,{name:"isRainwayVideoDecoderValue"}),enableHevc:T.Lm,videoProcessingAttribute:T.Kg,perfTrackerProfile:(0,T.y$)(U.PerfTrackerProfile,{name:"isPerfTrackerProfileValue"}),remove78FPSHack:T.Lm,safeAreaInsets:Object.assign((e=>null==e||$(e)),{toString:()=>"isPartialRectOrNullish"}),latencyPreset:(0,T.y$)(U.LatencyPreset,{name:"isLatencyPresetValue"}),setCodecPreferences:T.Lm,useTizenH264MainSdpHack:T.Lm,enableFEC:T.Lm,userDesiredWidth:T.Bf,userDesiredHeight:T.Bf,preferMainH264Profile:T.Lm,emitStreamStatisticsSimplifiedEvent:T.Lm,enableNetworkQualityIndicator:T.Lm,videoElementAriaLabel:T.Kg},O=(0,T.yy)(B,{name:"validateVideoConfiguration",ignoreNullish:!0,throwErrors:!0});var H,G,K,q,X,_,W=i(89263);class z{constructor(){this.priority=0,this.intercept=async e=>o.InterceptedRequest.fromRequest(e,{additionalHeaders:{"Content-Type":"application/json; charset=utf-8"}})}}function Y(e){return!!e.code||!!e.message}function j(e){const t=e;if(null==e)return l.ws.Unknown;switch(t){case K.NoEntitlement:return l.ws.NoEntitlement;case K.ContentInUse:return l.ws.TitleIdInUse;case K.ContentOffline:return l.ws.TitleOffline;case K.GamePassExpired:return l.ws.GamePassExpired;case K.XboxLiveAccountCurfew:return l.ws.XboxLiveAccountCurfew;case K.BlockedByParentalControls:return l.ws.BlockedByParentalControls;case K.BlockedByScreenTime:return l.ws.BlockedByScreenTime;case K.BlockedByAppTime:return l.ws.BlockedByAppTime;case K.TransferTokenMicrosoftAccountUnfamiliarLocation:return l.ws.TransferTokenMicrosoftAccountUnfamiliarLocation;case K.TransferTokenMicrosoftAccountProofUp:return l.ws.TransferTokenMicrosoftAccountProofUp;case K.KickForSignOut:return l.ws.AccessDenied;case K.ManagedDevkitUnauthorized:return l.ws.ManagedDevkitUnauthorized;case K.ManagedDevkitAccessToAccountDenied:return l.ws.ManagedDevkitAccessToAccountDenied;case K.ManagedDevkitInvalidRedeemCode:return l.ws.ManagedDevkitInvalidRedeemCode;case K.ManagedDevkitAccountDoesNotExist:return l.ws.ManagedDevkitAccountDoesNotExist;case K.ManagedDevkitSessionDoesNotExist:return l.ws.ManagedDevkitSessionDoesNotExist;case K.ManagedDevkitStreamingSessionDoesNotExist:return l.ws.ManagedDevkitStreamingSessionDoesNotExist;case K.ManagedDevkitStreamingSessionNotInExpectedState:return l.ws.ManagedDevkitStreamingSessionNotInExpectedState;case K.ManagedDevkitStreamingSessionNoValidPassword:return l.ws.ManagedDevkitStreamingSessionNoValidPassword;case K.ManagedDevkitAccessToSessionDenied:return l.ws.ManagedDevkitAccessToSessionDenied;case K.ServiceInternalError:return l.ws.ServiceInternalError;default:return l.ws.ServiceSpecificError}}!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.Ambiguous=300]="Ambiguous",e[e.MovedPermanently=301]="MovedPermanently",e[e.Moved=301]="Moved",e[e.Found=302]="Found",e[e.Redirect=302]="Redirect",e[e.SeeOther=303]="SeeOther",e[e.RedirectMethod=303]="RedirectMethod",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.RedirectKeepVerb=307]="RedirectKeepVerb",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.IAmATeapot=418]="IAmATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(H||(H={})),function(e){e.WaitingForResources="WaitingForResources",e.ReadyToConnect="ReadyToConnect",e.Provisioning="Provisioning",e.Provisioned="Provisioned",e.Failed="Failed"}(G||(G={})),function(e){e.NoEntitlement="NoEntitlement",e.ContentInUse="ContentInUse",e.ContentOffline="ContentOffline",e.GamePassExpired="GamePassExpired",e.XboxLiveAccountCurfew="XboxLiveAccountCurfew",e.BlockedByParentalControls="BlockedByParentalControls",e.BlockedByScreenTime="BlockedByScreenTime",e.BlockedByAppTime="BlockedByAppTime",e.TransferTokenMicrosoftAccountUnfamiliarLocation="TransferTokenMicrosoftAccountUnfamiliarLocation",e.TransferTokenMicrosoftAccountProofUp="TransferTokenMicrosoftAccountProofUp",e.KickForSignOut="KickForSignOut",e.TrialTimeExpired="TrialTimeExpired",e.TrialAccessDenied="TrialAccessDenied",e.ManagedDevkitUnauthorized="ManagedDevkitUnauthorized",e.ManagedDevkitAccessToAccountDenied="https://greenbelt.com/probs/access-to-account-denied",e.ManagedDevkitInvalidRedeemCode="https://greenbelt.com/probs/invalid-redeem-code",e.ManagedDevkitAccountDoesNotExist="https://greenbelt.com/probs/account-does-not-exist",e.ManagedDevkitSessionDoesNotExist="https://greenbelt.com/probs/session-does-not-exist",e.ManagedDevkitStreamingSessionDoesNotExist="https://greenbelt.com/probs/streaming-session-does-not-exist",e.ManagedDevkitStreamingSessionNotInExpectedState="https://greenbelt.com/probs/streaming-session-not-in-expected-state",e.ManagedDevkitStreamingSessionNoValidPassword="https://greenbelt.com/probs/streaming-session-no-valid-password",e.ManagedDevkitAccessToSessionDenied="https://greenbelt.com/probs/access-to-session-denied",e.ServiceInternalError="InternalError"}(K||(K={})),function(e){e.ConnectedStandby="ConnectedStandby",e.On="On",e.Off="Off",e.Unknown="Unknown",e.SystemUpdate="SystemUpdate"}(q||(q={})),function(e){e[e.Off=0]="Off",e[e.White=1]="White",e[e.Black=2]="Black"}(X||(X={})),function(e){e.ConnectedStorage="ConnectedStorage",e.PersistentLocalStorage="PersistentLocalStorage",e.SharedLocalStorage="SharedLocalStorage",e.QuickResume="QuickResume"}(_||(_={}));const J=async(e,t)=>{const i=await t.text();if(!i)return;let n;try{n=JSON.parse(i)}catch(s){}if(n){const i=n;i&&Y(i)&&e.throw(`ServiceErrorDetails issue detected. Code:${i.code}, Message:${i.message}, Status:${t.status}`,j(i.code));const s=n.errorDetails;s&&Y(s)&&e.throw(`ServiceErrorDetails issue detected. Code:${s.code}, Message:${s.message}, Status:${t.status}`,j(s.code))}t.ok||e.error(`Failing body unprocessed: ${i}`)};class Q{constructor(e){this.logger=e,this.priority=0,this.intercept=async(e,t)=>{const i=t.clone();return await J(this.logger,i),t}}}class Z{constructor(e){this.logger=e,this.priority=0,this.intercept=async(e,t)=>{if("Network request failed"===t.message?this.logger.throw("The network request failed",l.ws.NoNetwork):"Failed to fetch"===t.message?this.logger.throw("Failed to fetch",l.ws.NoNetwork):"Timeout"===t.message&&this.logger.throw("The operation timed out",l.ws.Timeout),!(t instanceof o.HttpError))throw t;const i=t.response.clone();switch(await J(this.logger,i),i.status){case H.Forbidden:this.logger.throw("Forbidden",l.ws.AuthUnauthorized);case H.Unauthorized:this.logger.throw("Unauthorized",l.ws.AuthUnauthorized);case H.Conflict:this.logger.throw("A resource is already in use by the current user. Please try again",l.ws.Conflict);case H.NotFound:this.logger.throw("Not Found",l.ws.NotFound);case H.Gone:this.logger.throw("The session is gone",l.ws.Gone)}throw t}}}class ee{constructor(e){this.headers=e,this.priority=0,this.intercept=async e=>this.headers?o.InterceptedRequest.fromRequest(e,{additionalHeaders:this.headers}):e}}class te{constructor(e){this.user=e,this.priority=0,this.intercept=async e=>{const t=await this.user.getAuthorizationHeader();return o.InterceptedRequest.fromRequest(e,{additionalHeaders:{Authorization:t}})}}}function ie(e,t,i){const n=[new te(t),new ee(i)];return(0,o.createInterceptedFetch)(e,{request:n})}const ne=(e,t)=>{if(t instanceof o.HttpError){if(t.response.status===H.Conflict)return!0;if(t.response.status===H.BadGateway)return!0}else if(t instanceof a.F)return t.code===l.ws.Conflict||(t.code===l.ws.ServiceInternalError||!(t.code!==l.ws.NoNetwork&&!l.ws.Timeout));return(0,o.DEFAULT_RETRY_PREDICATE)(e,t)};class se{constructor(e=new w.W,t=globalThis.fetch){this.cv=e,this.logger=c.r.Instance;this.playFetch=(0,o.createInterceptedFetch)(t,{request:[new z,new W.CorrelationVectorInterceptor((async()=>this.cv.increment().getValue()))],error:[new Z(this.logger)]})}setSessionCv(e){this.cv=e}async loginUser(e,t){const i=e.endpointSettings.getHeaders();let n=`${e.endpointSettings.getDomain()}/v2/login/user`;null!==i&&void 0!==i&&i.get("Forwarded")&&(n+="/delegated");const s=ie(this.playFetch,e,i),o=await s(n,{method:"POST",body:(0,u.A)(t)}),r=await o.json();return r.retrievedAtTimestamp=Date.now(),[r,o]}async getOfferings(e,t){const i=`${t.getDomain()}/v1/offerings/user`,n=(0,o.createInterceptedFetch)(this.playFetch,{request:[new ee(t.getHeaders())]}),s={authenticationType:"Xbox",token:e},r=await n(i,{method:"POST",body:(0,u.A)(s)}),a=await r.text(),l=JSON.parse(a);return this.logger.info(`retrieved ${l.offerings.length} offerings for user`),l.offerings}}var oe;i(8697),i(8096),i(98376),i(46929),i(10568),i(14293);!function(e){e.Production="prod",e.Test="test",e.Integration="int",e.Default="unset-http-environment"}(oe||(oe={}));const re="{httpEnv}",ae="{prefix}",le=`https://gssv-play-${re}.xboxlive.com`,ce=`https://${ae}.gssv-play-${re}.xboxlive.com`,de=new RegExp("^[a-zA-Z0-9]{1,30}$");class he{constructor(e,t,i){this.sdkInstallId=t,this.headers=new Headers,this.logger=c.r.Instance,this.telemetry=d.H.Instance,Object.values(oe).includes(e)||this.logger.throw(`Invalid http environment provided: ${e}`,l.ws.InvalidArgument),this.domainName=le.replace(re,e),this.domainNameWithPrefix=ce.replace(re,e),i&&Object.entries(i).forEach((([e,t])=>{var i;return null===(i=this.headers)||void 0===i?void 0:i.append(e,t)}))}clone(){const e=new he(oe.Default,this.sdkInstallId);return e.domainName=this.domainName,e.domainNameWithPrefix=this.domainNameWithPrefix,this.headers.forEach(((t,i)=>e.headers.append(i,t))),e}setDomain(e,t=!1){e.includes("://")||(e=`https://${e}`);const i=new RegExp("^https:\\/\\/(([a-zA-Z0-9]{1,30})\\.)*[\\-a-zA-Z]+\\.xboxlive\\.com$");t||i.test(e)||this.logger.throw(`Invalid domain name provided: ${e}`,l.ws.InvalidServicesDomain),this.logger.info(`EndpointSettings replacing domain ${this.domainName} with new domain ${e}`);const n=i.exec(e),s=3===(null===n||void 0===n?void 0:n.length)?n[2]:"";this.telemetry.trackEvent({event:d.X.ServicesDomainChanged,oldDomain:this.domainName,newDomain:e,region:s}),this.domainName=e}getDomain(){return this.domainName}getDomainWithPrefix(e){return de.test(e)?this.domainNameWithPrefix.replace(ae,e):(this.logger.error(`Invalid DNS prefix provided: ${e}`),this.domainName)}getDomainForAuth(e,t){if(e===v.AzureFrontDoor)return t?this.getDomainWithPrefix(t):this.getDomain();if(e===v.AzureTrafficManager)return this.getDomainWithPrefix("atm");throw new Error(`Unhandled AuthRoutingService type specified: ${e}`)}getHeaders(){return this.headers}getSdkInstallId(){return this.sdkInstallId}}const ue=e=>{switch(e){case y.w.Stereo:return"Stereo";case y.w.Mono:return"Mono";default:return c.r.Instance.throw(`Unknown audio mode: ${e}`,l.ws.InvalidArgument)}},ge=e=>e===x.P.WebRTCV1?"V3;WebrtcTransport.dll":c.r.Instance.throw(`Unknown stream type: ${e}`,l.ws.InvalidArgument);var me;!function(e){e[e.Release=0]="Release",e[e.Next=1]="Next"}(me||(me={}));const pe=e=>{switch(e){case me.Release:return"Release";case me.Next:return"Next";default:return c.r.Instance.throw(`Unknown release channel: ${e}`,l.ws.InvalidArgument)}},Se=e=>e===x.P.WebRTCV1?"WebRTCV1":c.r.Instance.throw(`Unknown streamType: ${e}`,l.ws.InvalidArgument),ve=e=>{switch(e){case U.PerfTrackerProfile.Default:return"Default";case U.PerfTrackerProfile.LowerMaxBufferLimit:return"LowerMaxBufferLimit";case U.PerfTrackerProfile.DirectCapture30FPS:return"DirectCapture30FPS";default:return c.r.Instance.throw(`Unknown perfTrackerProfile: ${e}`,l.ws.InvalidArgument)}};var fe,ye=i(84048);!function(e){e[e.Closed=0]="Closed",e[e.Inactive=1]="Inactive",e[e.Obscured=2]="Obscured",e[e.Visible=3]="Visible",e[e.Active=4]="Active"}(fe||(fe={}));i(31759),i(84915),i(75604),i(41532),i(32950),i(73599),i(64770),i(62080),i(97012),i(31274),i(29548),i(47342),i(14825),i(92467),i(67497),i(88236);var we,Ce=i(48227),Te=i(77981),be=i(38216);class Ie{constructor(){this.scope="/streaming/debug/messages",this.logger=c.r.Instance}onMessage(e,t){const i=JSON.parse(t);this.logger.log(i.logLevel,`Game Sent : ${i.message}`)}onTransaction(e,t,i){this.logger.verbose(`Received transaction message ${t}`),i.complete("")}}class ke{constructor(e,t){this.playClient=e,this.userSession=t,this.isShutdown=!1,this.instanceId=++ke.instances,this.logger=new c.r("StreamConnectionSignaler",`(${this.instanceId})`)}async sdpExchange(e){const t={Data:e};await this.playClient.sendSdp(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath,t);const i=await this.continueWithSdpPolling(),n=(0,u.A)(i);return this.logger.info(`Received Sdp response ${n}`),null!==n&&void 0!==n?n:""}async iceExchange(e){const t={Data:e};await this.playClient.sendIce(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath,t);const i=(await this.continueWithIcePolling()).map((e=>(0,u.A)(e)));return this.logger.info(`Received Ice response ${(0,u.A)(i)}`),null!==i&&void 0!==i?i:""}shutdown(){this.isShutdown=!0}async continueWithSdpPolling(){this.logger.info("Polling for Sdp response...");const e=await this.playClient.getSdp(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath);return e||new Promise(((e,t)=>{this.isShutdown?this.logger.rejectWithWarning("Sdp polling shut down.",l.ws.Cancelled,t):setTimeout((()=>{e(this.continueWithSdpPolling())}),100)}))}async continueWithIcePolling(){this.logger.info("Polling for Ice response...");const e=await this.playClient.getIce(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath);return e||new Promise(((e,t)=>{this.isShutdown?this.logger.rejectWithWarning("Ice polling shut down.",l.ws.Cancelled,t):setTimeout((()=>{e(this.continueWithIcePolling())}),100)}))}}ke.instances=0,function(e){e[e.Landscape=0]="Landscape",e[e.Portrait=1]="Portrait"}(we||(we={}));i(86741);class Ae{constructor(e){var t;this.onScreenOrientationChanged=()=>{const e=this.getScreenOrientation();e!==this.orientation&&(this.orientation=e,this.handler(this.orientation))},this.onWindowOrientationChanged=()=>{const e=this.getWindowOrientation();e!==this.orientation&&(this.orientation=e,this.handler(this.orientation))},this.handler=e,null!==(t=window.screen)&&void 0!==t&&t.orientation&&"onchange"in window.screen.orientation?(window.screen.orientation.addEventListener("change",this.onScreenOrientationChanged),this.orientation=this.getScreenOrientation()):"onorientationchange"in window&&(window.addEventListener("orientationchange",this.onWindowOrientationChanged),this.orientation=this.getWindowOrientation()),void 0!==this.orientation&&this.handler(this.orientation)}stop(){var e;null!==(e=window.screen)&&void 0!==e&&e.orientation&&"onchange"in window.screen.orientation?window.screen.orientation.removeEventListener("change",this.onScreenOrientationChanged):"onorientationchange"in window&&window.removeEventListener("orientationchange",this.onWindowOrientationChanged)}getScreenOrientation(){return window.screen.orientation.type.startsWith("portrait")?we.Portrait:we.Landscape}getWindowOrientation(){return 0===window.orientation||180===window.orientation?we.Portrait:we.Landscape}}i(93510);const Pe="/streaming/prototypes/stateshare/",Ee=`${Pe}ShowShareDialog`,xe=`${Pe}activate`,Me="/streaming/systemUi/messages/",De=`${Me}ShowApplication`,Re=`${Me}ShowMessageDialog`,Fe=`${Me}ShowPurchase`,Le=`${Me}ShowVirtualKeyboard`,Ne=`${Me}ShowTimerExtension`,Ue=`${Me}ShowFeedback`,$e=`${Me}ShowMicrophoneSettings`,Ve=`${Me}ToggleMute`,Be=`${Me}ShowPrivilegeBlocked`,Oe=`${Me}ShowSendInvites`,He=`${Me}ShowStateShare`,Ge=`${Me}ShowPeoplePicker`,Ke=`${Me}ShowLaunchParty`,qe=`${Me}__ShowShareDialog`;class Xe{constructor(e,t){this.handler=e,this.systemUiAdapter=t,this.scope=Pe,this.logger=c.r.Instance}onMessage(e,t){if(this.systemUiAdapter&&this.handler)try{let i,n;switch(e){case Ee:{const e=JSON.parse(t),s=this.handler.createEncapsulatedStateShareUrl(e);i=qe;const o={Url:s,Title:e.title,Text:e.description};n=JSON.stringify(o);break}default:this.logger.warning(`Wrong state share message ${t} received from target ${e}`)}i&&n&&this.systemUiAdapter.onMessage(i,n)}catch(i){this.logger.error(`Failed to handle state share message ${t} for target ${e}: ${(0,u.A)(i)}`)}}onTransaction(e,t,i){if(this.systemUiAdapter)try{e.substr(this.scope.length);this.logger.warning(`Wrong state share message ${t} received from target ${e}`)}catch(n){this.logger.error(`Failed to handle state share message ${t} for target ${e}: ${(0,u.A)(n)}`)}}}var _e,We,ze;!function(e){e[e.ShowSendInvites=8]="ShowSendInvites",e[e.ShowVirtualKeyboard=10]="ShowVirtualKeyboard",e[e.ShowPeoplePicker=13]="ShowPeoplePicker",e[e.ShowLaunchParty=15]="ShowLaunchParty",e[e.ShowMessageDialog=19]="ShowMessageDialog",e[e.ShowPurchase=27]="ShowPurchase",e[e.ShowApplication=31]="ShowApplication",e[e.ShowTimerExtension=32]="ShowTimerExtension",e[e.BlockGuide=33]="BlockGuide",e[e.ShowFeedback=37]="ShowFeedback",e[e.ShowMicrophoneSettings=38]="ShowMicrophoneSettings",e[e.ToggleMute=39]="ToggleMute",e[e.ShowPrivilegeBlockedAddFriend=40]="ShowPrivilegeBlockedAddFriend",e[e.ShowPrivilegeBlockedMultiplayer=41]="ShowPrivilegeBlockedMultiplayer",e[e.ShowGameTimeNotification=42]="ShowGameTimeNotification",e[e.ShowStateShare=43]="ShowStateShare",e[e.ShowPrivilegeBlocked=-43]="ShowPrivilegeBlocked",e[e.ShowShareDialog=-44]="ShowShareDialog"}(_e||(_e={})),function(e){e[e.Default=0]="Default",e[e.Url=1]="Url",e[e.EmailSmtpAddress=5]="EmailSmtpAddress",e[e.Number=29]="Number",e[e.Password=31]="Password",e[e.TelephoneNumber=32]="TelephoneNumber",e[e.Search=50]="Search"}(We||(We={})),function(e){e[e.None=0]="None",e[e.AcceptUserInputAfterDelay=1]="AcceptUserInputAfterDelay"}(ze||(ze={}));const Ye=e=>{switch(e){case De:return _e.ShowApplication;case Re:return _e.ShowMessageDialog;case Fe:return _e.ShowPurchase;case Le:return _e.ShowVirtualKeyboard;case Ne:return _e.ShowTimerExtension;case Ue:return _e.ShowFeedback;case $e:return _e.ShowMicrophoneSettings;case Ve:return _e.ToggleMute;case qe:return _e.ShowShareDialog;case Be:return _e.ShowPrivilegeBlocked;case Oe:return _e.ShowSendInvites;case He:return _e.ShowStateShare;case Ge:return _e.ShowPeoplePicker;case Ke:return _e.ShowLaunchParty;default:return c.r.Instance.throw("Unknown system ui type",l.ws.NotFound)}};class je{constructor(e){this.scope=Me,this.systemUiHandler=e,this.logger=c.r.Instance,this.telemetry=d.H.Instance}onMessage(e,t){try{const i=Ye(e),n=(0,Te.A)();this.logger.info(`Received system ui for target ${e} with message: ${t} and id ${(0,u.A)(n)}`),this.systemUiHandler.onShowSystemUi({id:n,message:t,type:i,cancel:()=>{this.telemetry.trackEvent({event:d.X.SystemUiCancel,systemUiType:_e[i]})},complete:e=>{this.telemetry.trackEvent({event:d.X.SystemUiCompleted,systemUiType:_e[i]})}}),this.telemetry.trackEvent({event:d.X.SystemUiShow,systemUiType:_e[i]})}catch(i){this.logger.error(`Failed to show system ui for target ${e}: ${(0,u.A)(i)}`)}}onTransaction(e,t,i){try{const n=Ye(e),s=(0,Te.A)();this.logger.info(`Received system ui transaction for target ${e} with message: ${t} and id ${(0,u.A)(s)}`),i.setOnRemoteCancellation((()=>{try{this.telemetry.trackEvent({event:d.X.SystemUiRemoteCancellation,systemUiType:_e[n]}),this.systemUiHandler.onHideSystemUi({id:s,type:n})}catch(e){this.logger.error(`Error when trying to hide system ui ${n} with id ${s}: ${(0,u.A)(e)}`)}})),this.systemUiHandler.onShowSystemUi({id:s,message:t,type:n,cancel:()=>{this.telemetry.trackEvent({event:d.X.SystemUiCancel,systemUiType:_e[n]}),i.cancel()},complete:e=>{this.telemetry.trackEvent({event:d.X.SystemUiCompleted,systemUiType:_e[n]}),i.complete(e)}}),this.telemetry.trackEvent({event:d.X.SystemUiShow,systemUiType:_e[n]})}catch(n){this.logger.error(`Failed to show system ui for target ${e}: ${(0,u.A)(n)}`),i.cancel()}}}function Je(e,t,i,n){if(!(t in e))return c.r.Instance.error(`The message for target '${n}' is missing the '${t}' field.`),d.H.Instance.trackEvent({event:d.X.MessageMissingField,target:n,field:t}),!1;if(typeof e[t]!==i){const s=typeof e[t];return c.r.Instance.error(`The message for target '${n}' has a type mismatch of the '${t}' field. The expected type is '${i}' but was '${s}.'`),d.H.Instance.trackEvent({event:d.X.MessageMismatchFieldType,target:n,field:t,expectedType:i,actualType:s}),!1}return!0}class Qe{constructor(e){this.scope="/streaming/touchcontrols",this.touchControlHandler=e,this.logger=c.r.Instance}onMessage(e,t){if(this.touchControlHandler)try{switch(e.substr(this.scope.length)){case"/hide":this.touchControlHandler.onHideTouchControls();break;case"/patchstate":{const i=JSON.parse(t);if(!Je(i,"patch","string",e))return;this.touchControlHandler.onUpdateTouchControlState({patch:i.patch});break}case"/showlayout":this.touchControlHandler.onShowTouchControlLayoutV2({layout:t});break;case"/showlayoutv2":{const i=JSON.parse(t);if(!Je(i,"layoutId","string",e))return;this.touchControlHandler.onShowTouchControlLayoutV2({layout:i.layoutId,patch:i.patch});break}case"/showtitledefault":this.touchControlHandler.onShowTitleDefaultLayout();break;default:this.logger.warning(`Wrong touch control message ${t} received from target ${e}`)}}catch(i){this.logger.error(`Failed to handle touch control message ${t} for target ${e}: ${(0,u.A)(i)}`)}}onTransaction(e,t,i){this.logger.info(`Canceled touch control transaction message ${t} for target ${e} because transactions are not expected.`),i.cancel()}}function Ze(e){return e instanceof HTMLVideoElement&&"function"===typeof e.msGetVideoProcessingTypes}class et{constructor(e){this.throttleDurationSeconds=e}shouldThrottleStrictly(){const e=Date.now();if(!this.lastUnthrottledTimestamp)return this.lastUnthrottledTimestamp=e,!1;const t=1e3*this.throttleDurationSeconds;return!(e-this.lastUnthrottledTimestamp>=t)||(this.lastUnthrottledTimestamp=e,!1)}}class tt{constructor(e,t){this.eventThresholdSeconds=t,this.eventThresholdMet=!1,this.throttler=new et(e)}shouldEmitEvent(e){return!this.eventThresholdMet&&(e<=this.eventThresholdSeconds?(this.eventThresholdMet=!0,!0):!this.throttler.shouldThrottleStrictly())}}class it extends r.EventEmitter{constructor(e,t){super(),this.playClient=e,this.userSession=t,this.disconnectEventThrottler=new tt(900,180),this.userSession.correlationVector.increment(),this.start()}start(){this.stop();const e=1e3*this.userSession.keepAlivePulseInSeconds;this.timerHandle=window.setInterval((()=>{this.heartBeatSession()}),e)}stop(){this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=void 0)}sendServiceShutdown(){return this.stop(),this.playClient.deleteSession(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath)}async heartBeatSession(){try{const e=await this.playClient.sendSessionKeepAlive(this.userSession.user,this.userSession.endpointSettings,this.userSession.sessionPath);e.reason&&e.aliveSeconds&&this.disconnectEventThrottler.shouldEmitEvent(e.aliveSeconds)&&this.emit("sessionDisconnectWarning",{reason:e.reason,timeUntilDisconnectSeconds:e.aliveSeconds})}catch(e){if(e instanceof a.F)switch(e.code){case l.ws.NotFound:case l.ws.Gone:return c.r.Instance.warning("Session is gone. Stopping Keep Alive Heart"),void this.stop()}c.r.Instance.warning(`heartBeatSession error detected, but will continue retrying ${e}`)}}}class nt{constructor(){this.controlChannel=null,this.inputChannel=null,this.logger=c.r.Instance,this.queuedGamepadConnections=new Set}start(e,t){var i;this.controlChannel=e,this.inputChannel=t,this.queuedGamepadConnections.forEach((e=>{this.sendGamepadChangedMessage(e,!0)})),this.queuedGamepadConnections.clear(),null===(i=this.inputChannel)||void 0===i||i.setInputFeedbackHandler(this.inputFeedbackHandler)}onGamepadChanged(e,t){if(!this.controlChannel)return this.logger.warning("Received gamepad changed event without a control channel to report it on."),void(t?this.queuedGamepadConnections.add(e):this.queuedGamepadConnections.delete(e));this.sendGamepadChangedMessage(e,t)}onGamepadInput(e,t){var i;null===(i=this.inputChannel)||void 0===i||i.sendGamepadInput(e,t)}onKeyboardInput(e){var t;null===(t=this.inputChannel)||void 0===t||t.sendKeyboardInput(e)}onPointerInput(e,t){var i;null===(i=this.inputChannel)||void 0===i||i.queuePointerInput(e,[t])}onMouseInput(e){var t;null===(t=this.inputChannel)||void 0===t||t.queueMouseInput(e)}onSensorInput(e){var t;null===(t=this.inputChannel)||void 0===t||t.sendSensorInput(e)}sendGamepadChangedMessage(e,t){var i,n;this.logger.info(`Sending gamepad changed; index:${e} wasAdded: ${t}.`),null===(i=this.controlChannel)||void 0===i||i.sendGamepadChangedMessage(e,t),null===(n=this.inputChannel)||void 0===n||n.updateGamepads(e,t)}onFlushMetadataRequest(){var e;null===(e=this.inputChannel)||void 0===e||e.sendMetadata()}setInputFeedbackHandler(e){var t;this.inputFeedbackHandler=e,null===(t=this.inputChannel)||void 0===t||t.setInputFeedbackHandler(e)}}class st{constructor(e,t){this.logger=c.r.Instance,this.onVibration=(e,t)=>{const i=this.gamepadStates.get(e);if(i)for(const n of i.sources){const i=n[0].substring(0,n[0].length-e.toString().length),s=this.inputFeedbackHandlers.get(i),o=n[0].substring(i.length),r=parseInt(o,10);s&&s.onVibration(r,t)}},this.inputSink=e,this.gamepadStates=new Map,this.inputSourceErrorLogged=new Set,this.gamepadMappingsToSend=[],this.inputFeedbackHandlers=new Map,this.nexusButtonHandler=t,this.inputSink.setInputFeedbackHandler({stop:()=>this.onInputFeedbackHandlerStop(),onVibration:this.onVibration})}start(e,t){this.inputSink.start(e,t)}onGamepadChanged(e,t,i){const n=e+t;let o=this.gamepadStates.get(0);if(i){const e={mapping:s()(s()({},C.iz),{},{GamepadIndex:0})};o||(this.inputSink.onGamepadChanged(0,i),o={lastGamepadMapping:s()(s()({},C.iz),{},{GamepadIndex:0}),sources:new Map},this.gamepadStates.set(0,o),this.gamepadMappingsToSend.push(s()(s()({},C.iz),{},{GamepadIndex:0}))),o.sources.set(n,e)}else{if(!o||!o.sources.has(n))return;if(1===o.sources.size){this.inputSink.onGamepadChanged(0,i),this.gamepadStates.delete(0);const e=this.gamepadMappingsToSend.findIndex((e=>0===e.GamepadIndex));-1!==e&&this.gamepadMappingsToSend.splice(e,1)}else o.sources.delete(n)}}onKeyboardInput(e){this.inputSink.onKeyboardInput(e)}onPointerInput(e,t,i){this.inputSink.onPointerInput(t,i)}onSensorInput(e){this.inputSink.onSensorInput(e)}onFlushMetadataRequest(){this.inputSink.onFlushMetadataRequest()}onGamepadInput(e,t,i,n){for(const u of i){const t=e+u.GamepadIndex,i=0,n=this.gamepadStates.get(i),s=null===n||void 0===n?void 0:n.sources.get(t);s?this.copyGamepadMapping(u,s.mapping):this.inputSourceErrorLogged.has(e+u.GamepadIndex)||(this.logger.error(`The input source ${e} for the gamepad ${u.GamepadIndex} was never connected but is trying to send input.`),this.inputSourceErrorLogged.add(e+u.GamepadIndex))}if(n){for(const[e,i]of this.gamepadStates){let n=null;for(const t of this.gamepadMappingsToSend)t.GamepadIndex===e&&(n=t);if(n){if(n.Dirty=!1,this.mergeGamepadMappings(i.sources,n),this.nexusButtonHandler)if(1===n.Nexus){var s,o,r,a;if(this.firstNexusPressDownTimestampMs){if(t-this.firstNexusPressDownTimestampMs>=500)null===(s=(o=this.nexusButtonHandler).onNexusLongPress)||void 0===s||s.call(o)}else this.firstNexusPressDownTimestampMs=t,null===(r=(a=this.nexusButtonHandler).onNexusDown)||void 0===r||r.call(a);n.Nexus=0}else if(this.firstNexusPressDownTimestampMs){var l,c,d,h;if(null===(l=(c=this.nexusButtonHandler).onNexusUp)||void 0===l||l.call(c),t-this.firstNexusPressDownTimestampMs<500)null===(d=(h=this.nexusButtonHandler).onNexusPress)||void 0===d||d.call(h);this.firstNexusPressDownTimestampMs=void 0}this.areGamepadMappingsEqual(i.lastGamepadMapping,n)||(n.Dirty=!0,this.copyGamepadMapping(n,i.lastGamepadMapping))}}this.inputSink.onGamepadInput(t,this.gamepadMappingsToSend)}}sendKeepAliveGamepadInput(){let e=!1;for(const i of this.gamepadMappingsToSend)if(i.Dirty=!1,0===i.GamepadIndex){var t;e=!0,i.Dirty=!0,i.Virtual=!0,i.LeftThumbXAxis>.9?i.LeftThumbXAxis=i.LeftThumbXAxis-.1:i.LeftThumbXAxis=i.LeftThumbXAxis+.1;const n=null===(t=this.gamepadStates.get(0))||void 0===t?void 0:t.lastGamepadMapping;n&&(n.LeftThumbXAxis=i.LeftThumbXAxis)}e&&this.inputSink.onGamepadInput(performance.now(),this.gamepadMappingsToSend)}setInputFeedbackHandler(e,t){t?this.inputFeedbackHandlers.set(e,t):this.inputFeedbackHandlers.delete(e)}onInputFeedbackHandlerStop(){for(const e of this.inputFeedbackHandlers)e[1].stop()}areGamepadMappingsEqual(e,t){return e.A===t.A&&e.B===t.B&&e.X===t.X&&e.Y===t.Y&&e.LeftShoulder===t.LeftShoulder&&e.RightShoulder===t.RightShoulder&&e.LeftTrigger===t.LeftTrigger&&e.RightTrigger===t.RightTrigger&&e.View===t.View&&e.Menu===t.Menu&&e.LeftThumb===t.LeftThumb&&e.RightThumb===t.RightThumb&&e.DPadUp===t.DPadUp&&e.DPadDown===t.DPadDown&&e.DPadLeft===t.DPadLeft&&e.DPadRight===t.DPadRight&&e.Nexus===t.Nexus&&e.LeftThumbXAxis===t.LeftThumbXAxis&&e.LeftThumbYAxis===t.LeftThumbYAxis&&e.RightThumbXAxis===t.RightThumbXAxis&&e.RightThumbYAxis===t.RightThumbYAxis}copyGamepadMapping(e,t){t.A=e.A,t.B=e.B,t.X=e.X,t.Y=e.Y,t.LeftShoulder=e.LeftShoulder,t.RightShoulder=e.RightShoulder,t.LeftTrigger=e.LeftTrigger,t.RightTrigger=e.RightTrigger,t.View=e.View,t.Menu=e.Menu,t.LeftThumb=e.LeftThumb,t.RightThumb=e.RightThumb,t.DPadUp=e.DPadUp,t.DPadDown=e.DPadDown,t.DPadLeft=e.DPadLeft,t.DPadRight=e.DPadRight,t.Nexus=e.Nexus,t.LeftThumbXAxis=e.LeftThumbXAxis,t.LeftThumbYAxis=e.LeftThumbYAxis,t.RightThumbXAxis=e.RightThumbXAxis,t.RightThumbYAxis=e.RightThumbYAxis,t.PhysicalPhysicality=e.PhysicalPhysicality,t.VirtualPhysicality=e.VirtualPhysicality,t.Dirty=e.Dirty}onMouseInput(e){this.inputSink.onMouseInput(e)}clampAnalog(e,t=-1,i=1){return Math.max(t,Math.min(i,e))}mergeGamepadMappings(e,t){this.copyGamepadMapping(C.iz,t);for(const i of e.values())t.A|=i.mapping.A,t.B|=i.mapping.B,t.X|=i.mapping.X,t.Y|=i.mapping.Y,t.LeftShoulder|=i.mapping.LeftShoulder,t.RightShoulder|=i.mapping.RightShoulder,t.LeftTrigger+=i.mapping.LeftTrigger,t.RightTrigger+=i.mapping.RightTrigger,t.View|=i.mapping.View,t.Menu|=i.mapping.Menu,t.LeftThumb+=i.mapping.LeftThumb,t.RightThumb+=i.mapping.RightThumb,t.DPadUp|=i.mapping.DPadUp,t.DPadDown|=i.mapping.DPadDown,t.DPadLeft|=i.mapping.DPadLeft,t.DPadRight|=i.mapping.DPadRight,t.Nexus|=i.mapping.Nexus,t.LeftThumbXAxis+=i.mapping.LeftThumbXAxis,t.LeftThumbYAxis+=i.mapping.LeftThumbYAxis,t.RightThumbXAxis+=i.mapping.RightThumbXAxis,t.RightThumbYAxis+=i.mapping.RightThumbYAxis,t.PhysicalPhysicality|=i.mapping.PhysicalPhysicality,t.VirtualPhysicality|=i.mapping.VirtualPhysicality;t.LeftTrigger=this.clampAnalog(t.LeftTrigger,0),t.RightTrigger=this.clampAnalog(t.RightTrigger,0),t.LeftThumb=this.clampAnalog(t.LeftThumb),t.RightThumb=this.clampAnalog(t.RightThumb),t.LeftThumbXAxis=this.clampAnalog(t.LeftThumbXAxis),t.LeftThumbYAxis=this.clampAnalog(t.LeftThumbYAxis),t.RightThumbXAxis=this.clampAnalog(t.RightThumbXAxis),t.RightThumbYAxis=this.clampAnalog(t.RightThumbYAxis)}}class ot extends r.EventEmitter{constructor(e,t,i=!0){super(),this.inputSource=e,this.inputSink=t,this.sendGamepadInput=i,this.inputSource=e,this.inputSink=t,this.sendGamepadInput=i,this.connectedGamepads=new Set}start(e,t){this.inputSink.start(e,t)}onGamepadChanged(e,t){this.inputSink.onGamepadChanged(this.inputSource,e,t),t?this.connectedGamepads.add(e):(this.connectedGamepads.delete(e),0===this.connectedGamepads.size&&this.emit("physicalGamepadDisconnect",{}))}onGamepadInput(e,t){this.inputSink.onGamepadInput(this.inputSource,e,t,this.sendGamepadInput);let i=!1;for(const n of t)if(!n.Virtual&&n.Dirty){i=!0;break}i&&this.emit("physicalGamepadInput",{})}onKeyboardInput(e){this.inputSink.onKeyboardInput(e)}onPointerInput(e,t){this.inputSink.onPointerInput(this.inputSource,e,t)}onMouseInput(e){this.inputSink.onMouseInput(e)}onSensorInput(e){this.inputSink.onSensorInput(e)}onFlushMetadataRequest(){this.inputSink.onFlushMetadataRequest()}setInputFeedbackHandler(e){this.inputSink.setInputFeedbackHandler(this.inputSource,e)}}var rt=i(43245);class at extends r.EventEmitter{get configuration(){return this._configuration}get connectionState(){return this._connectionState}get isShutdown(){return null!=this._shutdownTime}get initialConnectionTime(){var e;return null!==(e=this._initialConnectionTime)&&void 0!==e?e:void 0}get connectionType(){return this._connectionType}get shutdownTime(){var e;return null!==(e=this._shutdownTime)&&void 0!==e?e:void 0}get microphoneState(){return this._microphoneState}get paused(){return this._paused}get duration(){return null==this._initialConnectionTime?NaN:null==this._shutdownTime?Date.now()-this._initialConnectionTime.getTime():this._shutdownTime.getTime()-this._initialConnectionTime.getTime()}get isPlayStreamGestureRequired(){var e;return!1!==this.configuration.options.requestPlayStreamGesture&&((null===(e=this.stream)||void 0===e?void 0:e.isPlayStreamGestureRequired)||this.isPlayStreamGestureRequiredByAudioContext)}get isPlayStreamGestureRequiredByAudioContext(){return["suspended","interrupted"].includes(this.audioContext.state)}get videoWidth(){return this._videoWidth}get videoHeight(){return this._videoHeight}constructor(e,t,i,n,o,r,a,l){super(),this.instanceId=++at.instances,this._connectionState=rt.g$.Disconnected,this.sourceManagedInputSink=null,this.physicalInputSink=null,this.messageChannel=null,this.chatManager=null,this.stream=null,this.orientationListener=null,this.sessionHeartBeat=null,this.measurementElement=null,this.renderTargetResizeObserver=null,this._initialConnectionTime=null,this._shutdownTime=null,this.isTryReconnectInProgress=!1,this._microphoneState=rt.EO.Muted,this.streamStats=null,this._renderTargetWidth=0,this._renderTargetHeight=0,this._videoWidth=0,this._videoHeight=0,this._paused=!1,this.kickedByNewSession=!1,this.tryEnableChatAsync=async e=>{var t,i;e?await(null===(t=this.chatManager)||void 0===t?void 0:t.enable()):null===(i=this.chatManager)||void 0===i||i.disable()},this.setMicrophoneState=e=>{switch(this._microphoneState=e,e){case rt.EO.Enabled:d.H.Instance.trackEvent(s()({event:d.X.MicrophoneEnable},this.telemetryContext.getProps(this.cv)));break;case rt.EO.Muted:case rt.EO.NotAllowed:case rt.EO.NotFound:d.H.Instance.trackEvent(s()({event:d.X.MicrophoneDisable,reason:e},this.telemetryContext.getProps(this.cv)))}this.emit("microphoneStateChanged",{})},this.onStreamDisconnectThenReconnect=()=>{this.expectedDisconnectReason?(this.logger.info("StreamSession transport disconnected."),this.doDisconnect()):this.tryReconnect()},this.queueDimensionsMessage=()=>{this._debounceTimeoutId&&clearTimeout(this._debounceTimeoutId),this._debounceTimeoutId=setTimeout((()=>{this.sendDimensionsMessage()}),300)},this.onPhysicalGamepadDisconnect=()=>{this.emit("physicalGamepadDisconnect",{})},this.onPhysicalGamepadInput=()=>{this.emit("physicalGamepadInput",{})},this.logStreamDisconnected=()=>{this.logger.info("Old StreamSession transport disconnected.")},this.onStreamQualityLevelChanged=e=>{this.emit("sessionQualityLevelChanged",{session:this,level:e.level})},this.onVideoMediaStreamChanged=e=>{this.emit("videoMediaStreamChanged",e)},this.onNetworkQualityIndicatorEventReceived=e=>{this.emit("networkQualityIndicatorUpdate",e)},this.onStreamStatsEventReceived=e=>{this.emit("streamStatsUpdate",e)},this.onAudioMediaStreamChanged=e=>{this.emit("audioMediaStreamChanged",e)},this.onVideoResized=()=>{this.updateDimensions()},this.emitPlayStreamGestureRequiredChangedEvent=()=>{const{isPlayStreamGestureRequired:e}=this;this.emit("playStreamGestureRequiredChanged",{isPlayStreamGestureRequired:e})},this.sendPartyChatConfigurationMessage=async e=>{if(!this.messageChannel)return void this.logger.warning("Could not send a party chat configuration message because the message channel does not exist.");this.logger.info("Sending party chat configuration message");const t=await this.messageChannel.sendTransaction("/streaming/social/partyChatAudioCoordination/setPartyChatActive",(0,u.A)({partyChatActive:!e})),i=JSON.parse(t);"Error"===i.status?this.logger.throw("Server indicates an error when we sent a party chat configuration message",i.code):this.logger.verbose("Successfully sent party chat configuration message.")},this.onCursorChanged=e=>{const t=JSON.parse(e);this.emit("cursorChanged",{cursor:t.cursor})},this.cv=i,this._configuration=e,this.serverInfo=t,this.streamType=n,this._connectionType=o,this.audioContext=r,this.telemetryContext=a,this.logger=new c.r("StreamSession",`(${this.instanceId})`),this.logger.info("StreamSession created.",(0,u.A)(be.A.browserDetails.version),(0,u.A)(this.serverInfo)),this.deviceInformation=null!==l&&void 0!==l?l:new Ce.P6}getMessageChannel(){return this.messageChannel}getSessionTelemetryProperties(){return this.telemetryContext.getProps(this.cv)}getControlChannel(){var e,t;return null!==(e=null===(t=this.stream)||void 0===t?void 0:t.getControlChannel())&&void 0!==e?e:null}setPlayClient(e){this.playClient=e}setUserSession(e){this.userSession=e}async connectAsync(e){this.isShutdown&&this.logger.throw("StreamSession already shutdown.",l.ws.InvalidState),this._connectionState!==rt.g$.Disconnected&&this.logger.throw("Disconnect the StreamSession before trying to connect.",l.ws.BadConfiguration);"blocked"===this.deviceInformation.capabilities.streamReadiness?(this.expectedDisconnectReason=rt.RS.BrowserUnsupported,this.doDisconnect(),this.logger.throw("Disconnected due to incompatible browser",l.ws.Unsupported)):this.logger.info("Valid browser detected");this.playClient&&this.userSession&&(this.sessionHeartBeat=new it(this.playClient,this.userSession),this.sessionHeartBeat.addListener("sessionDisconnectWarning",(e=>{this.emit("sessionDisconnectWarning",e)}))),this.measurementElement=document.createElement("div"),this.measurementElement.style.position="fixed",this.measurementElement.style.top="0",this.measurementElement.style.left="0",this.measurementElement.style.width="1cm",this.measurementElement.style.height="1cm",this.measurementElement.style.visibility="hidden",this.measurementElement.style.pointerEvents="none",e.appendChild(this.measurementElement);try{await this.doConnectAsync(e),this.emitPlayStreamGestureRequiredChangedEvent()}catch(t){const e=(0,h.g)(t);throw this.logger.error(`Failed to connect to stream: ${(0,u.A)(e)}`),this.expectedDisconnectReason=rt.RS.ConnectingFailed,e.message.includes("timed out")?this.expectedDisconnectErrorCode=l.ws.Timeout:this.expectedDisconnectErrorCode=l.ws.Unknown,this.doDisconnect(),e}}async doConnectAsync(e,t=!1){var n,o,r,a;const c=Date.now();if(null===(n=this.stream)||void 0===n||n.addListener("streamDisconnected",this.logStreamDisconnected),null===(o=this.stream)||void 0===o||o.shutdown(),this.streamType===x.P.WebRTCV1){this.configuration.options.releaseChannel!==me.Release&&this.logger.warning(`Unknown release channel for WebRtcStreamV1. Release Channel: ${this.configuration.options.releaseChannel}`);const{WebRtcStreamV1:e}=await Promise.all([i.e(6483),i.e(3638)]).then(i.bind(i,49856)),t=this.playClient&&this.userSession?new ke(this.playClient,this.userSession):void 0;this.stream=new e(this.serverInfo,this.cv.extend(),this.deviceInformation,this.audioContext,this.configuration.inputConfiguration,this.configuration.videoConfiguration,this.configuration.audioConfiguration,this.configuration.networkConfiguration,this.configuration.nqiConfiguration,t)}else this.logger.throw(`Unknown stream type: ${this.streamType}`,l.ws.InvalidArgument);this.stream.addListener("videoMediaStreamChanged",this.onVideoMediaStreamChanged),this.stream.addListener("audioMediaStreamChanged",this.onAudioMediaStreamChanged),this.stream.addListener("streamDisconnected",this.onStreamDisconnectThenReconnect),this.stream.addListener("streamQualityLevelChanged",this.onStreamQualityLevelChanged),this.stream.addListener("videoResized",this.onVideoResized),this.stream.addListener("playStreamGestureRequiredChanged",this.emitPlayStreamGestureRequiredChangedEvent),this.stream.addListener("networkQualityIndicatorUpdate",this.onNetworkQualityIndicatorEventReceived),this.stream.addListener("streamStatsUpdate",this.onStreamStatsEventReceived),this.sourceManagedInputSink=new st(new nt,this.configuration.nexusButtonHandler),this.physicalInputSink=new ot("physical",this.sourceManagedInputSink,!0),this.physicalInputSink.addListener("physicalGamepadDisconnect",this.onPhysicalGamepadDisconnect),this.physicalInputSink.addListener("physicalGamepadInput",this.onPhysicalGamepadInput),this.connectionState!==rt.g$.Reconnecting&&this.setConnectionState(rt.g$.Connecting);const g=new je(this.configuration.systemUiHandler),m=[g,new at.ServerInitiatedDisconnectHandler(this),new at.TitleInfoHandler(this),new Qe(this.configuration.touchControlHandler),new Xe(this.configuration.stateSharePrototypeHandler,g)];this._configuration.options.enableDebugMessageHandler&&m.push(new Ie),this.configuration.inputConfiguration.enableAbsoluteMouse&&m.push(new at.MouseModeAdapter(this)),await this.stream.connectAsync(e,this.physicalInputSink,m),this.containerElement=e;null===(r=this.stream.getControlChannel())||void 0===r||r.sendAuthorizationMessage("4BDB3609-C1F1-4195-9B37-FEFF45DA8B8E"),this.messageChannel=this.stream.getMessageChannel(),this.messageChannel?this.messageChannel.setOnReady((()=>{var e,t,i,n;const s={version:[0,2,0],systemUis:this.configuration.systemUiHandler.getSupportedSystemUis()};this.logger.info("Sending system ui configuration message"),null===(e=this.messageChannel)||void 0===e||e.sendMessage("/streaming/systemUi/configuration",s);const o={clientAppInstallId:this.getOrCreateUniqueId()};null===(t=this.messageChannel)||void 0===t||t.sendMessage("/streaming/properties/clientappinstallidchanged",o),this.orientationListener=new Ae((e=>{const t={orientation:e};try{var i;null===(i=this.messageChannel)||void 0===i||i.sendMessage("/streaming/characteristics/orientationchanged",t)}catch(n){this.logger.warning(`Error sending orientation change through message channel. Error: ${n}`)}})),this.sendTouchInputEnabledMessage(this.configuration.inputConfiguration.enableTouchInput);const r=null===(i=this.stream)||void 0===i?void 0:i.getRenderTarget();r?(this.renderTargetResizeObserver=new ResizeObserver((e=>{this.updateDimensions()})),this.renderTargetResizeObserver.observe(r),this.updateDimensions(!0,!0)):this.logger.warning("Unable to listen for resize events because no render target was returned"),this.sendClientDeviceCapabilitiesMessage(this.configuration.clientDeviceCapabilities);null===(n=this.messageChannel)||void 0===n||null===(n=n.sendTransaction("/streaming/title/constrain",{constrain:!1}))||void 0===n||n.catch((e=>{this.logger.error(`Error un-constraining title on connect: ${(0,u.A)(e)}`)})),null!=this._configuration.audioConfiguration.enableGameChat&&this.sendPartyChatConfigurationMessage(this._configuration.audioConfiguration.enableGameChat).catch((e=>{const t=(0,h.g)(e);this.logger.warning(`Error when sending party chat configuration message: ${(0,u.A)(t)}`)})),this.sendAbsoluteMouseCapableMessage(this.configuration.inputConfiguration.enableAbsoluteMouse)})):this.logger.warning("Message channel does not exist on stream."),this.chatManager=this.stream.getChatManager(),null===(a=this.chatManager)||void 0===a||a.setUpdateMicrophoneState(this.setMicrophoneState),this.chatManager?this.configuration.audioConfiguration.enableMicrophone&&await this.tryEnableChatAsync(!0):this.logger.warning("Chat channel does not exist on stream."),d.H.Instance.trackEvent(s()({event:d.X.SessionConnect,durationInMs:Date.now()-c,isRetry:t},this.telemetryContext.getProps(this.cv))),this.logger.info("Successfully connected."),this.setConnectionState(rt.g$.Connected),null==this._initialConnectionTime&&(this._initialConnectionTime=new Date),this.streamStats=new L(this.stream,this.configuration.statisticsConfiguration,this.telemetryContext,this.cv),this.streamStats.startAudioVideoStatsCollection(),this.emitPlayStreamGestureRequiredChangedEvent(),this.audioContext.addEventListener("statechange",this.emitPlayStreamGestureRequiredChangedEvent)}isRecoverableConnectionError(e){if(e instanceof a.F){const t=e;return t.code==l.ws.NoNetwork||t.code==l.ws.Failed||t.code==l.ws.Timeout}return!1}async tryReconnect(){this.isTryReconnectInProgress||(this.logger.info("Transport error; reconnecting..."),this.isTryReconnectInProgress=!0,this.setConnectionState(rt.g$.Reconnecting),await this.tryReconnectInternal(),this.isTryReconnectInProgress=!1)}async tryReconnectInternal(){for(let t=0;t<20;t++){if(await new Promise((e=>setTimeout(e,1e3))),this._connectionState!==rt.g$.Reconnecting&&this._connectionState!==rt.g$.Connecting){this.logger.info(`Aborting reconnect; connection state is ${this._connectionState}`);break}try{if(this.containerElement)return d.H.Instance.trackEvent(s()({event:d.X.SessionReconnect,retryAttempt:t+1,durationInMs:this.duration},this.telemetryContext.getProps(this.cv))),this.logger.info(`Reconnect attempt #${t+1}`),void await this.doConnectAsync(this.containerElement,!0);this.logger.info(`Reconnect cancelled; state: ${rt.g$.Reconnecting}.`)}catch(e){const i=(0,h.g)(e);if(!this.isRecoverableConnectionError(i)){this.logger.info(`Reconnect attempt ${t+1} failed: ${(0,u.A)(i)}; aborting.`);break}this.logger.info(`Reconnect attempt ${t+1} failed: ${(0,u.A)(i)}; retrying...`)}}this.expectedDisconnectReason||(this.expectedDisconnectReason=rt.RS.TransportError,this.expectedDisconnectErrorCode=l.ws.NoNetwork,this.logger.info("Failed to reconnect."),this.doDisconnect())}doDisconnect(){var e,t,i,n,o,r,a,c,h,u,g,m,p,S,v,f,y,w,C,T,b;this.logger.info(`StreamSession disconnecting; reason:${this.expectedDisconnectReason}, errorCode:${this.expectedDisconnectErrorCode}`),d.H.Instance.trackEvent(s()({event:d.X.SessionDisconnect,durationInMs:this.duration,disconnectReason:null!==(e=this.expectedDisconnectReason)&&void 0!==e?e:"",disconnectErrorCode:null!==(t=this.expectedDisconnectErrorCode)&&void 0!==t?t:""},this.telemetryContext.getProps(this.cv))),this.streamStats&&this.streamStats.collectionBegan&&this.streamStats.shouldFireDisconnectEvent()&&this.streamStats.sendStreamingStatisticsEvent(),this.audioContext.removeEventListener("statechanged",this.emitPlayStreamGestureRequiredChangedEvent),null===(i=this.physicalInputSink)||void 0===i||i.removeListener("physicalGamepadDisconnect",this.onPhysicalGamepadDisconnect),null===(n=this.physicalInputSink)||void 0===n||n.removeListener("physicalGamepadInput",this.onPhysicalGamepadInput),this.physicalInputSink=null,null===(o=this.stream)||void 0===o||o.removeListener("streamDisconnected",this.logStreamDisconnected),null===(r=this.stream)||void 0===r||r.removeListener("streamDisconnected",this.onStreamDisconnectThenReconnect),null===(a=this.stream)||void 0===a||a.removeListener("streamQualityLevelChanged",this.onStreamQualityLevelChanged),null===(c=this.stream)||void 0===c||c.removeListener("videoMediaStreamChanged",this.onVideoMediaStreamChanged),null===(h=this.stream)||void 0===h||h.removeListener("audioMediaStreamChanged",this.onAudioMediaStreamChanged),null===(u=this.stream)||void 0===u||u.removeListener("videoResized",this.onVideoResized),null===(g=this.stream)||void 0===g||g.removeListener("playStreamGestureRequiredChanged",this.emitPlayStreamGestureRequiredChangedEvent),null===(m=this.stream)||void 0===m||m.removeListener("networkQualityIndicatorUpdate",this.onNetworkQualityIndicatorEventReceived),null===(p=this.stream)||void 0===p||p.removeListener("streamStatsUpdate",this.onStreamStatsEventReceived),null===(S=this.sessionHeartBeat)||void 0===S||S.removeAllListeners("sessionDisconnectWarning"),this.containerElement=void 0,null===(v=this.renderTargetResizeObserver)||void 0===v||v.disconnect(),this.renderTargetResizeObserver=null,null===(f=this.orientationListener)||void 0===f||f.stop(),this.orientationListener=null,null===(y=this.streamStats)||void 0===y||y.shutdown(),null===(w=this.stream)||void 0===w||w.shutdown(),this.stream=null,null===(C=this.sessionHeartBeat)||void 0===C||C.stop(),this.messageChannel=null,this.chatManager=null,[this.measurementElement].forEach((e=>{null!=e&&e.parentNode&&e.parentNode.removeChild(e)})),this.measurementElement=null,this.setConnectionState(rt.g$.Disconnected),this.emit("sessionDisconnected",{reason:null!==(T=this.expectedDisconnectReason)&&void 0!==T?T:rt.RS.TransportError,errorCode:null!==(b=this.expectedDisconnectErrorCode)&&void 0!==b?b:l.ws.Failed}),this.expectedDisconnectReason=void 0,this.expectedDisconnectErrorCode=void 0}disconnect(){this.expectedDisconnectReason=rt.RS.CleanDisconnect,this.expectedDisconnectErrorCode=l.ws.Success,this.logger.info("StreamSession disconnect()."),this.doDisconnect()}shutdown(){if(this._debounceTimeoutId&&clearTimeout(this._debounceTimeoutId),this.isShutdown)this.logger.warning("StreamSession already shutdown.");else{var e,t;if("closed"!==this.audioContext.state&&this.audioContext.close(),this.expectedDisconnectReason=rt.RS.CleanShutdown,this.expectedDisconnectErrorCode=l.ws.Success,this.logger.info("StreamSession shutdown()."),this.doDisconnect(),this.kickedByNewSession)null===(e=this.sessionHeartBeat)||void 0===e||e.stop(),this.kickedByNewSession=!1;else null===(t=this.sessionHeartBeat)||void 0===t||t.sendServiceShutdown();this.sessionHeartBeat=null,this._shutdownTime=new Date,d.H.Instance.trackEvent(s()({event:d.X.SessionShutdown,durationInMs:this.duration},this.telemetryContext.getProps(this.cv)))}}pause(){var e;if(this._paused=!0,null===(e=this.stream)||void 0===e||e.pauseInputProcessing(),this._configuration.options.constrainTitleOnPause&&this._connectionState===rt.g$.Connected){var t;const e={constrain:!0};null===(t=this.messageChannel)||void 0===t||t.sendTransaction("/streaming/title/constrain",e).catch((e=>{this._connectionState===rt.g$.Connected?this.logger.error(`Error constraining title on pause: ${(0,u.A)(e)}`):this.logger.verbose(`[${this._connectionState}] Ignoring expected error constraining title on pause: ${(0,u.A)(e)}`)}))}}resume(){var e;if(this._paused=!1,null===(e=this.stream)||void 0===e||e.resumeInputProcessing(),this._configuration.options.constrainTitleOnPause&&this._connectionState===rt.g$.Connected){var t;const e={constrain:!1};null===(t=this.messageChannel)||void 0===t||t.sendTransaction("/streaming/title/constrain",e).catch((e=>{this._connectionState===rt.g$.Connected?this.logger.error(`Error un-constraining title on resume: ${(0,u.A)(e)}`):this.logger.verbose(`[${this._connectionState}] Ignoring expected error un-constraining title on resume: ${(0,u.A)(e)}`)}))}}releaseHeldMouseButtonsAndKeyboardKeys(){var e;null===(e=this.stream)||void 0===e||e.releaseHeldMouseButtonsAndKeyboardKeys()}setMouseManagerPointerEventHandler(e){var t;null===(t=this.stream)||void 0===t||t.setMouseManagerPointerEventHandler(e)}setServerRequestedCursorStyle(e){var t;null===(t=this.stream)||void 0===t||t.setServerRequestedCursorStyle(e)}updateSessionConfigurationOptions(e){this.setConfiguration({options:s()(s()({},this._configuration.options),e)})}async updateAudioConfigurationAsync(e){const t=this._configuration.audioConfiguration,i=s()(s()({},t),e);try{var n;this.setConfiguration({audioConfiguration:i}),await(null===(n=this.stream)||void 0===n?void 0:n.updateAudioConfiguration(i)),null!=i.enableMicrophone&&t.enableMicrophone!==i.enableMicrophone&&await this.tryEnableChatAsync(i.enableMicrophone),null!=i.enableGameChat&&t.enableGameChat!==i.enableGameChat&&await this.sendPartyChatConfigurationMessage(i.enableGameChat)}catch(o){throw this.setConfiguration({audioConfiguration:t}),this.logger.error(`Updating audio configuration failed: ${(0,u.A)(o)}`),o}}async updateInputConfigurationAsync(e){const t=this._configuration.inputConfiguration,i=s()(s()({},t),e);try{var n;this.setConfiguration({inputConfiguration:i}),null===(n=this.stream)||void 0===n||n.updateInputConfiguration(i),t.enableTouchInput!==i.enableTouchInput&&this.sendTouchInputEnabledMessage(i.enableTouchInput),t.enableAbsoluteMouse!==i.enableAbsoluteMouse&&this.sendAbsoluteMouseCapableMessage(i.enableAbsoluteMouse)}catch(o){throw this.setConfiguration({inputConfiguration:t}),o}}async updateVideoConfigurationAsync(e){const t=this._configuration.videoConfiguration,i=s()(s()({},t),e);try{var n,o;this.setConfiguration({videoConfiguration:i}),null===(n=this.stream)||void 0===n||n.updateVideoConfiguration(i);const e=null===(o=this.stream)||void 0===o?void 0:o.getRenderTarget();Ze(e)&&(i.videoProcessingAttribute?e.msVideoProcessing=i.videoProcessingAttribute:e.msVideoProcessing=void 0),V(t.safeAreaInsets,i.safeAreaInsets)||this.queueDimensionsMessage(),d.H.Instance.trackEvent(s()({event:d.X.VideoConfigurationUpdated,configuration:i},this.telemetryContext.getProps(this.cv)))}catch(r){throw this.setConfiguration({videoConfiguration:t}),r}}async updateClientDeviceCapabilitiesAsync(e){const t=this._configuration.clientDeviceCapabilities,i=s()(s()({},t),e);try{this.setConfiguration({clientDeviceCapabilities:i});(t.maxTouchBundleLayoutVersion!==i.maxTouchBundleLayoutVersion||t.maxTouchBundleManifestVersion!==i.maxTouchBundleManifestVersion)&&this.sendClientDeviceCapabilitiesMessage(i)}catch(n){throw this.setConfiguration({clientDeviceCapabilities:t}),n}}getCorrelationVector(){return this.cv}getOrCreateUniqueId(){const e="Microsoft.GameStreaming.UniqueId",t=localStorage.getItem(e);if(null!==t)return t;const i=(0,Te.A)().toString();try{localStorage.setItem(e,i)}catch(n){}return i}setCollectStatisticsState(e,t){var i,n;e?null===(i=this.streamStats)||void 0===i||i.removePause(t):null===(n=this.streamStats)||void 0===n||n.addPause(t)}async fileABug(e,t){if(this.logger.info("executing StreamSession.fileABug()"),this.userSession&&this.playClient){this.logger.info("StreamSession.fileABug() - Found userSession and playClient");const n=this.userSession;try{return await this.playClient.sendSessionFileABug(n.user,n.sessionPath,{alias:e,description:t}),this.logger.info("StreamSession.fileABug() was successful"),!0}catch(i){const e=(0,h.g)(i);return this.logger.error(`StreamSession.fileABug() failed - ${e.message}`),!1}}return this.logger.warning("StreamSession.fileABug() failed - userSession or playClient was undefined"),!1}async acceptGameInviteAsync(e,t){this.logger.info(`Accept Game Invite for titleId: ${e}, invite type: ${t.type}`),this.messageChannel||this.logger.throw("Unable to accept game invite; is the stream connected?",l.ws.InvalidState),d.H.Instance.trackEvent(s()({event:d.X.GameInviteAccepted,requestedTitleId:e,inviteType:t.type},this.telemetryContext.getProps(this.cv)));let i="",n="";switch(t.type){case rt.if.Invite:i="/streaming/social/acceptGameInvite",n=(0,u.A)({invitePayload:t.jsonPayload});break;case rt.if.Join:i="/streaming/social/joinGameSession",n=(0,u.A)({joinPayload:t.jsonPayload});break;case rt.if.TitleActivation:i="/streaming/social/rawActivation",n=(0,u.A)({activationUri:t.jsonPayload})}await this.messageChannel.sendTransaction(i,n)}async sendStateSharePrototypeAsync(e){this.logger.info(`Sending debug state share data for productId: ${e.productId}`,e.payload),this.messageChannel||this.logger.throw("Unable to send state share data; is the stream connected?",l.ws.InvalidState),d.H.Instance.trackEvent(s()({event:d.X.StateSharePrototypeInitiated,shareProductId:e.productId,shareTitle:e.title,shareCreator:e.creator},this.telemetryContext.getProps(this.cv))),this.messageChannel.sendMessage(xe,(0,u.A)(e))}async acceptStateShareAsync(e){this.logger.info("Accept state share"),this.messageChannel||this.logger.throw("Unable to accept state share; is the stream connected?",l.ws.InvalidState);const t=(0,u.A)(e);this.messageChannel.sendTransaction("/streaming/social/acceptStateShare",(0,u.A)({stateSharePayload:t}))}sendKeepAlive(){var e,t;(null===(e=this.stream)||void 0===e?void 0:e.getInputChannel())?(this.onVirtualGamepadChanged("keepalive",0,!0),null===(t=this.sourceManagedInputSink)||void 0===t||t.sendKeepAliveGamepadInput(),this.onVirtualGamepadChanged("keepalive",0,!1)):this.logger.warning("Failed to send keep alive, presumably the stream is gone")}getSupportedVideoProcessingAttributes(){var e;const t=null===(e=this.stream)||void 0===e?void 0:e.getRenderTarget();return Ze(t)?t.msGetVideoProcessingTypes():[]}sendTouchInputEnabledMessage(e){var t;const i={touchInputEnabled:null!==e&&void 0!==e&&e};null===(t=this.messageChannel)||void 0===t||t.queueMessage("/streaming/characteristics/touchinputenabledchanged",i)}sendClientDeviceCapabilitiesMessage(e){var t;const i={};e.maxTouchBundleLayoutVersion&&e.maxTouchBundleManifestVersion&&(i.maxTouchBundleLayoutVersion=e.maxTouchBundleLayoutVersion,i.maxTouchBundleManifestVersion=e.maxTouchBundleManifestVersion),null===(t=this.messageChannel)||void 0===t||t.queueMessage("/streaming/characteristics/clientdevicecapabilities",i)}sendAbsoluteMouseCapableMessage(e){var t;e&&(null===(t=this.messageChannel)||void 0===t||t.queueMessage("/streaming/mouse/clientAbsoluteMouseCapable",{}))}calculateVideoDimensionsFromRenderTargetDimensions(e,t){var i;const n=null===(i=this.stream)||void 0===i?void 0:i.getAspectRatio();return n&&isFinite(n)?e/n<=t?{width:e,height:e/n}:{width:t*n,height:t}:{width:e,height:t}}updateDimensions(e=!1,t=!1){var i;const n=null===(i=this.stream)||void 0===i?void 0:i.getRenderTarget();if(n){const{width:i,height:s}=this.calculateVideoDimensionsFromRenderTargetDimensions(n.scrollWidth,n.scrollHeight);(t||this._renderTargetWidth!==n.scrollWidth||this._renderTargetHeight!==n.scrollHeight||this._videoWidth!==i||this._videoHeight!==s)&&(this._renderTargetWidth=n.scrollWidth,this._renderTargetHeight=n.scrollHeight,this._videoWidth=i,this._videoHeight=s,this.emit("videoResized",{width:i,height:s}),e?(this._debounceTimeoutId&&(clearTimeout(this._debounceTimeoutId),this._debounceTimeoutId=void 0),this.sendDimensionsMessage()):this.queueDimensionsMessage())}}sendDimensionsMessage(){var e,t,i,n,s,o,r,c;if(!this.messageChannel)return void this.logger.warning("Unable to publish dimensions - Cannot acquire a reference to the message channel");const d=Math.trunc(this._videoWidth/this.measurementElement.scrollWidth*10),h=Math.trunc(this._videoHeight/this.measurementElement.scrollHeight*10);if(isNaN(h)||isNaN(d))return void this.logger.error("Unable to calculate video height or width in millimeters - Aborting publish");const u=window.devicePixelRatio,g=Math.round(this._renderTargetWidth*u),m=Math.round(this._renderTargetHeight*window.devicePixelRatio),p=Math.round((null!==(e=null===(t=this.configuration.videoConfiguration.safeAreaInsets)||void 0===t?void 0:t.left)&&void 0!==e?e:0)*window.devicePixelRatio),S=Math.round((null!==(i=null===(n=this.configuration.videoConfiguration.safeAreaInsets)||void 0===n?void 0:n.top)&&void 0!==i?i:0)*window.devicePixelRatio),v=Math.round((null!==(s=null===(o=this.configuration.videoConfiguration.safeAreaInsets)||void 0===o?void 0:o.right)&&void 0!==s?s:0)*window.devicePixelRatio),f=Math.round((null!==(r=null===(c=this.configuration.videoConfiguration.safeAreaInsets)||void 0===c?void 0:c.bottom)&&void 0!==r?r:0)*window.devicePixelRatio),y=Math.min(g,Math.max(0,p)),w=Math.min(m,Math.max(0,S)),C=Math.max(y,Math.min(g,g-v)),T=Math.max(w,Math.min(m,m-f));try{this.messageChannel.sendMessage("/streaming/characteristics/dimensionschanged",{horizontal:d,vertical:h,preferredWidth:g,preferredHeight:m,safeAreaLeft:y,safeAreaTop:w,safeAreaRight:C,safeAreaBottom:T,supportsCustomResolution:!0})}catch(b){if(!(b instanceof a.F&&b.code==l.ws.InvalidState))throw b;this.logger.verbose(`Error sending a 'dimensionschanged' message. Stream State = ${this._connectionState}`)}}setConnectionState(e){this._connectionState!==e&&(this._connectionState=e,this.emit("sessionConnectionStateChanged",{state:e}))}setConfiguration(e){this._configuration=s()(s()({},this.configuration),e),this.emit("sessionConfigurationChanged",{configuration:this._configuration})}onServerDisconnectMessage(e){const t=JSON.parse(e);let i;!function(e){e.KickByNewSession="KickByNewSession",e.KickForClosedGame="KickForClosedGame",e.KickForBeingIdle="KickForBeingIdle",e.KickForSignOut="KickForSignOut",e.KickForServerShutdown="KickForServerShutdown",e.KickForStopCommand="KickForStopCommand",e.KickForAppError="KickForAppError",e.KickForNoClientConnection="KickForNoClientConnection",e.KickForOutOfStreamingTime="KickForOutOfStreamingTime",e.WarningForBeingIdle="WarningForBeingIdle"}(i||(i={}));var n;if(new Map([[i.KickByNewSession,rt.RS.ServerKickByNewSession],[i.KickForClosedGame,rt.RS.ServerKickForClosedGame],[i.KickForBeingIdle,rt.RS.ServerKickForBeingIdle],[i.KickForSignOut,rt.RS.ServerKickForSignOut],[i.KickForServerShutdown,rt.RS.ServerKickForServerShutdown],[i.KickForStopCommand,rt.RS.ServerKickForStopCommand],[i.KickForAppError,rt.RS.ServerKickForAppError],[i.KickForNoClientConnection,rt.RS.ServerKickForNoClientConnection],[i.KickForOutOfStreamingTime,rt.RS.ServerKickForOutOfStreamingTime]]).has(t.reason))c.r.Instance.info(`Server disconnect message::${t.reason}, ${t.hr}.`),d.H.Instance.trackEvent(s()({event:d.X.ServerInitiatedDisconnect,reason:t.reason,errorCode:null!==(n=t.hr)&&void 0!==n?n:l.ws.Unknown},this.telemetryContext.getProps(this.cv))),this.expectedDisconnectReason=t.reason,t.hr&&(this.expectedDisconnectErrorCode=t.hr|0),this.kickedByNewSession=this.expectedDisconnectReason===rt.RS.ServerKickByNewSession||this.expectedDisconnectErrorCode===l.ws.SessionResumedElsewhere,c.r.Instance.info(`Server disconnect message::${this.expectedDisconnectReason}, ${this.expectedDisconnectErrorCode}.`),this.doDisconnect();else if("WarningForBeingIdle"===t.reason){var o,r;c.r.Instance.info(`Warning for being idle; secondsUntilKick:${t.secondsUntilKick}`),d.H.Instance.trackEvent(s()({event:d.X.WarningForBeingIdle,secondsUntilKick:null!==(o=t.secondsUntilKick)&&void 0!==o?o:0},this.telemetryContext.getProps(this.cv))),this.emit("sessionIdleWarning",{timeUntilDisconnectSeconds:null!==(r=t.secondsUntilKick)&&void 0!==r?r:0})}else c.r.Instance.warning(`Unrecognized server-initiated disconnect reason: ${t.reason}`)}onTitleInfoChanged(e){const t=JSON.parse(e);void 0===t.state&&(t.state=fe.Active),void 0===t.focused&&(t.focused=!0);let i=parseInt(t.titleid,16);isNaN(i)&&(i=0),t.titleid=i.toString(),c.r.Instance.info(`Title info changed: aumid:${t.titleaumid}, id:${t.titleid}, state:${t.state}, focused:${t.focused}.`),d.H.Instance.trackEvent({event:d.X.StreamTitleChanged,cV:this.cv.getValue(),title:t.titleid}),this.emit("sessionTitleInfoChanged",{titleAumid:t.titleaumid,titleId:i,state:t.state,focused:t.focused})}startAudioVideoStatsCollection(){var e;this.stream&&this.streamStats&&null!==(e=this.stream)&&void 0!==e&&e.isStatsCollectionSupported()?this.streamStats.startAudioVideoStatsCollection():this.logger.warning("startAudioVideoStatsCollection() was called but the stream is not ready or doesn't support this method yet")}getAllCollectedAudioVideoStats(){return this.streamStats&&this.streamStats.collectionBegan?this.streamStats.getAllCollectedAudioVideoStats():[]}onVirtualGamepadChanged(e,t,i){var n;null===(n=this.sourceManagedInputSink)||void 0===n||n.onGamepadChanged(e,t,i)}onVirtualGamepadInput(e,t,i){var n;const o=i.map((e=>s()(s()({},e),{},{LeftThumbYAxis:-e.LeftThumbYAxis,RightThumbYAxis:-e.RightThumbYAxis})));null===(n=this.sourceManagedInputSink)||void 0===n||n.onGamepadInput(e,t,o,!0)}onPlayStreamGesture(){var e;this.logger.info("[StreamSession] onPlayStreamGesture triggered"),null===(e=this.stream)||void 0===e||e.onPlayStreamGesture(),this.isPlayStreamGestureRequiredByAudioContext?this.audioContext.resume().catch((e=>{this.logger.warning(`Unable to resume AudioContext from the PlayStreamGestureRequiredChangedEvent callback - ${e.message}`)})):this.logger.verbose("AudioContext does not require a user interaction - Skipping resume")}onVirtualPointerInput(e,t,i){var n;null===(n=this.sourceManagedInputSink)||void 0===n||n.onPointerInput(e,t,i)}onVirtualMouseInput(e){var t;null===(t=this.sourceManagedInputSink)||void 0===t||t.onMouseInput(e)}}at.instances=0,at.TitleInfoHandler=class{constructor(e){this.streamSession=e,this.scope="/streaming/properties/titleinfo"}onMessage(e,t){try{c.r.Instance.info(`Received title info-changed message: ${t}`),this.streamSession.onTitleInfoChanged(t)}catch(i){c.r.Instance.error(`Failed to process message: ${(0,u.A)(i)}`)}}onTransaction(e,t,i){c.r.Instance.warning(`Received unexpected server title-changed transaction: ${t}`),i.cancel()}},at.ServerInitiatedDisconnectHandler=class{constructor(e){this.streamSession=e,this.scope="/streaming/sessionLifetimeManagement/serverInitiatedDisconnect"}onMessage(e,t){c.r.Instance.warning(`Received unexpected server disconnect message: ${t}`)}onTransaction(e,t,i){try{c.r.Instance.info(`Received server disconnect message: ${t}`);try{i.complete("")}catch(n){}this.streamSession.onServerDisconnectMessage(t)}catch(s){c.r.Instance.error(`Failed to process message: ${(0,u.A)(s)}`)}}},at.MouseModeAdapter=class{constructor(e){this.streamSession=e,this.scope="/streaming/mouse/cursor"}onMessage(e,t){try{c.r.Instance.info(`Received mouse mode message: ${t}`),this.streamSession.onCursorChanged(t)}catch(i){c.r.Instance.error(`Failed to process message: ${(0,u.A)(i)}`)}}onTransaction(e,t,i){c.r.Instance.error(`Unexpected mouse mode transaction with message: ${t}`),i.cancel()}};i(55367);const lt={iceGatheringTimeoutMs:T.Bf},ct=(0,T.yy)(lt,{name:"validateNetworkConfiguration",ignoreNullish:!0,throwErrors:!0}),dt={packetLossPercentageBadThreshold:T.Bf,pingMsBadThreshold:T.Bf,jitterMsBadThreshold:T.Bf,decodeMsBadThreshold:T.Bf,consecutiveBadIntervalsForTrigger:T.Bf,consecutiveGoodIntervalsForClear:T.Bf},ht=(0,T.yy)(dt,{name:"validateNetworkQualityIndicatorConfiguration",ignoreNullish:!0,throwErrors:!0}),ut=["options","systemUiHandler","touchControlHandler","nexusButtonHandler","clientDeviceCapabilities","pollingConfiguration"],gt=-(new Date).getTimezoneOffset();function mt(...e){const t={options:{directIpAddress:"",systemUpdateGroup:"",enableNarrator:!1,highContrastMode:X.Off,timezoneOffsetMinutes:gt,iceLocalOnly:!1,releaseChannel:me.Release,constrainTitleOnPause:!0,requestPlayStreamGesture:!0,enableOptionalDataCollection:void 0,enableDebugMessageHandler:!1},audioConfiguration:{audioMode:y.w.Stereo},statisticsConfiguration:{},inputConfiguration:{enableGamepadInput:!0,sensorInputPollingRateInHz:60},videoConfiguration:{showStreamStatisticsOverlay:!1,emitStreamStatisticsSimplifiedEvent:!1,enableNetworkQualityIndicator:!1},networkConfiguration:{iceGatheringTimeoutMs:5e3},systemUiHandler:{getSupportedSystemUis:()=>[],onHideSystemUi:()=>{},onShowSystemUi:()=>{}},clientDeviceCapabilities:{},touchControlHandler:void 0,stateSharePrototypeHandler:void 0,nexusButtonHandler:void 0,pollingConfiguration:new k(!1),nqiConfiguration:{jitterMsBadThreshold:20,packetLossPercentageBadThreshold:1,pingMsBadThreshold:80,decodeMsBadThreshold:12,consecutiveBadIntervalsForTrigger:5,consecutiveGoodIntervalsForClear:5}};return e.reduce(((e,t)=>(Object.keys(e).forEach((i=>{void 0!==t[i]&&(void 0===e[i]?e[i]=t[i]:Object.assign(e[i],t[i]))})),e)),t)}function pt(e){var t;const i=mt(e);return null===(t=i.options)||void 0===t||delete t.directIpAddress,i}const St={audioConfiguration:y.F,inputConfiguration:I,videoConfiguration:O,statisticsConfiguration:P,networkConfiguration:ct,nqiConfiguration:ht},vt=(()=>{const e=(0,T.yy)(St,{name:"validateClientStreamingConfigOverrides",ignoreNullish:!0,throwErrors:!0});return t=>null==t||e(t)})();function ft(e){return e.isFireOS&&!e.isSupportedTVBrowser?"android":e.osName}var yt;!function(e){e.CloudConsole="CloudConsole",e.PersonalConsole="PersonalConsole",e.ManagedDevkit="ManagedDevkit",e.Unknown="Unknown"}(yt||(yt={}));class wt{constructor(e,t,i,n,s){this.sessionPath="",this.sessionCv=e.getValue(),this.titleId=i,this.serverType=t,this.createTime=Date.now(),this.clientSessionId=null!==n&&void 0!==n?n:w.W.makeBase(),this.connectionType=s}setSessionPath(e){const t=new RegExp(".*([A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12})").exec(e);this.sessionPath=t?t[1]:e}getProps(e){var t;return{cV:e.getValue(),sessionCv:this.sessionCv,clientSessionId:this.clientSessionId,title:null!==(t=this.titleId)&&void 0!==t?t:"",sessionId:this.sessionPath,timeSinceCreateMs:Date.now()-this.createTime,serverType:this.serverType,connectionType:this.connectionType}}getClientSessionId(){return this.clientSessionId}}var Ct;!function(e){e.NotStarted="Session.Request.NotStarted",e.Queued="Session.Request.Queued",e.Launching="Session.Request.Launching",e.Ready="Session.Request.Ready",e.Cancelled="Session.Request.Cancelled"}(Ct||(Ct={}));class Tt extends r.EventEmitter{get state(){return this._state}get titleInfo(){return this._titleInfo}constructor(e,t,i,n,s,o,r,a,l,h){super(),this.maxRetryPollingSessionsCount=1,this.inFlight=!1,this.instanceId=++Tt.instances,this._state=Ct.NotStarted,this.configuration=e,this.user=t,this._titleInfo=h,this.cv=i,this.logger=new c.r("StreamSessionRequest",`(${this.instanceId})`),this.telemetry=d.H.Instance,this.playClient=n,this.endpointSettings=t.endpointSettings.clone(),this.locale=s,this.streamType=o,this.retryAttemptCount=0,this.telemetryContext=r,this.getTransferToken=a,this.deviceInformation=l}async createSession(e,t){try{this.progressCallback=e,this.inFlight&&this.logger.throw("StreamSessionRequest in use",l.ws.InvalidState);"blocked"===this.deviceInformation.capabilities.streamReadiness?this.logger.throw("Disconnected due to incompatible browser",l.ws.Unsupported):this.logger.verbose("Valid browser detected");return this.inFlight=!0,this.audioContext=t,await this.startProcessingRequest()}catch(i){throw i instanceof a.F&&this.emit("sessionRequestFailed",{errorCode:i.code}),i}}async continueWithPolling(){if(this.sessionPath||this.logger.throw("Polling has invalid state, call createSession instead",l.ws.InvalidState),this._state===Ct.Cancelled)return new Promise(((e,t)=>{this.logger.rejectWithWarning("StreamSessionRequest cancelled during polling",l.ws.Cancelled,t)}));try{const e=await this.playClient.getState(this.user,this.endpointSettings,this.sessionPath,this.configuration.pollingConfiguration);this.retryAttemptCount=0;const t=e.state;switch(this.logger.info(`stateResponseState:${t}`),e.transferUri&&this.endpointSettings.setDomain(e.transferUri),this.setState(t),t){case G.ReadyToConnect:return this.continueWithSendingTransferToken();case G.WaitingForResources:return new Promise((e=>{setTimeout((()=>{e(this.continueWithPolling())}),this.configuration.pollingConfiguration.queuePollingIntervalMs)}));case G.Provisioning:return new Promise((e=>{setTimeout((()=>{e(this.continueWithPolling())}),this.configuration.pollingConfiguration.provisioningPollingIntervalMs)}));case G.Provisioned:return this.continueWithProvisioned();default:this.telemetry.trackEvent(s()(s()({event:d.X.SessionFailed},this.telemetryContext.getProps(this.cv)),{},{errorMessage:`Failure polling progress: Received an unknown state: ${t}`})),this.logger.throw("SessionClient::PollProgress failed with failed state",l.ws.Unexpected)}}catch(e){if(this.logger.info(`Failed getState, retry: ${this.retryAttemptCount}`),e instanceof a.F&&(l.CW.includes(e.code)||e.code===l.ws.Unexpected)&&(this.telemetry.trackEvent(s()(s()({event:d.X.SessionFailed},this.telemetryContext.getProps(this.cv)),{},{errorCode:e.code,errorMessage:`Aborting polling retries due to service error: ${(0,l.kE)(e.code)}`})),this.logger.throw(`Aborting polling retries due to service error: ${(0,l.kE)(e.code)}`,e.code)),this.retryAttemptCount<this.maxRetryPollingSessionsCount)return this.retryAttemptCount+=1,new Promise((e=>{setTimeout((()=>{e(this.continueWithPolling())}),this.configuration.pollingConfiguration.retryPollingIntervalMs)}));this.logger.throw("No more retries allowed",l.ws.Timeout)}}async continueWithSendingTransferToken(){let e;this.sessionPath||this.logger.throw("Session has invalid state, call createSession instead",l.ws.InvalidState);try{if(e=await this.getTransferToken(),!e)throw new Error("TransferToken returned from getTransferToken is falsy")}catch(i){const e=(0,h.g)(i);this.logger.throw(e.message,l.ws.InvalidState)}const t={userToken:e};return await this.playClient.sendConnect(this.user,this.endpointSettings,this.sessionPath,t),this.continueWithPolling()}setState(e){let t=null;if(this._state!==Ct.Cancelled){switch(e){case G.Provisioned:t=Ct.Ready;break;case G.WaitingForResources:case G.ReadyToConnect:t=Ct.Queued;break;case G.Provisioning:t=Ct.Launching;break;case G.Failed:break;default:this.logger.throw(`SessionState failed: ${e}`,l.ws.Unknown)}var i;if(null!=t)this._state=t,null===(i=this.progressCallback)||void 0===i||i.call(this,this._state)}}async continueWithProvisioned(){var e,t,i,n;this.logger.info("continueWithProvisioned: Provisioned!");const o=await this.playClient.getConfiguration(this.user,this.endpointSettings,null!==(e=this.sessionPath)&&void 0!==e?e:"");if(this._state===Ct.Cancelled)return new Promise(((e,t)=>{this.logger.rejectWithWarning("StreamSessionRequest cancelled during provisioning",l.ws.Cancelled,t)}));this.telemetry.trackEvent(s()({event:d.X.SessionReady},this.telemetryContext.getProps(this.cv)));const r={user:this.user,sessionPath:null!==(t=this.sessionPath)&&void 0!==t?t:"",titleId:null!==(i=null===(n=this._titleInfo)||void 0===n?void 0:n.titleId)&&void 0!==i?i:"",serverInfo:o.serverDetails,keepAlivePulseInSeconds:o.keepAlivePulseInSeconds,correlationVector:this.cv.increment(),endpointSettings:this.endpointSettings},a=o.serverDetails;let c=this.configuration;if(o.clientStreamingConfigOverrides)try{if(this.configuration.options.ignoreServiceConfiguration)this.logger.info("Ignoring the service-specified StreamSessionConfiguration due to options override.");else{const e=s()({},o.clientStreamingConfigOverrides);ut.forEach((t=>{null!=e[t]&&(this.logger.warning(`Client-exclusive key "${t}" was defined in the clientStreamingConfigOverride - Removing the key from the service-provided config`),delete e[t])})),c=mt(this.configuration,e),this.logger.info("Merging the service-specified StreamSessionConfiguration on top of the client-specified StreamSessionConfiguration."),this.logger.verbose(`Merged Configuration:\n${(0,u.A)(c)}`)}this.logger.verbose(`Service-Specified Configuration:\n${(0,u.A)(o.clientStreamingConfigOverrides)}`),this.logger.verbose(`Client-Specified Configuration:\n${(0,u.A)(this.configuration)}`)}catch(p){const e=(0,h.g)(p);this.logger.error(`An unexpected error occurred while applying clientStreamingConfigOverrides - ${e.message}`)}const g=s()({event:d.X.SessionConfiguration,configuration:(0,u.A)(pt(c)),streamType:this.streamType},this.telemetryContext.getProps(this.cv));o.clientStreamingConfigOverrides&&!this.configuration.options.ignoreServiceConfiguration&&(g.serviceSpecifiedOverrides=(0,u.A)(o.clientStreamingConfigOverrides)),this.telemetry.trackEvent(g);const m=new at(c,a,this.cv.increment(),this.streamType,this.connectionType(),this.audioContext,this.telemetryContext,this.deviceInformation);return m.setUserSession(r),m.setPlayClient(this.playClient),this.inFlight=!1,m}async getWaitTime(){if(null!=this.playClient&&null!=this.user&&null!=this._titleInfo){if(null==this.waitTime){const e=await this.playClient.getTitleWaitTime(this.user,this._titleInfo.titleId);this.waitTime=s()({retrievedAtTimestamp:Date.now()},e),this.logger.info(`title wait time: ${(0,u.A)(this.waitTime)}`),setTimeout((()=>{this.waitTime=void 0}),this.configuration.pollingConfiguration.queuePollingIntervalMs)}return this.waitTime}}cancel(){this._state!==Ct.Cancelled&&(this.inFlight=!1,this._state=Ct.Cancelled,this.telemetry.trackEvent(s()({event:d.X.SessionCancelled},this.telemetryContext.getProps(this.cv))))}}Tt.instances=0;class bt extends Tt{constructor(e,t,i,n,s,o,r,a,l,c){super(e,t,i,n,s,o,r,a,l,c)}async triggerPlayRequest(e){try{this.retryAttemptCount=0;const t=await this.sendPlayRequest(this.user,e,this.cv);return this.logger.info(`sessionPath: ${t.sessionPath}`),this.sessionPath=t.sessionPath,this.telemetryContext.setSessionPath(t.sessionPath),this.telemetry.trackEvent(s()({event:d.X.SessionReceivedSessionPath},this.telemetryContext.getProps(this.cv))),this.continueWithPolling()}catch(t){if(this.logger.info(`triggerPlayRequest failed: ${t}`),t instanceof a.F){const e=t;this.logger.throw(`StreamSessionRequest: triggerPlay. GameStreamErrorCode: ${(0,l.kE)(e.code)}. GameStreamError: ${e.message}`,e.code)}this.logger.throw(`StreamSessionRequest: triggerPlay. Error:${(0,u.A)(t)}`,l.ws.Unknown)}}}class It extends bt{constructor(e,t,i,n,s,o,r,a,c){super(e,t,i,n,s,o,new wt(i,yt.CloudConsole,r.titleId,void 0,rt.Tu.Cloud),a,c,r),this._titleInfo||this.logger.throw("No title specified",l.ws.InvalidArgument)}async startProcessingRequest(){this.logger.info("Creating new cloud session."),this.telemetry.trackEvent(s()({event:d.X.SessionCreating,locale:this.locale,timezoneMinutes:this.configuration.options.timezoneOffsetMinutes},this.telemetryContext.getProps(this.cv)));const e=this.user.validateSystemUpdateGroup(this.configuration.options.systemUpdateGroup),t=this.playClient.deviceInformation,i={nanoVersion:ge(this.streamType),enableTextToSpeech:this.configuration.options.enableNarrator,magnifier:this.configuration.options.enableMagnifier,highContrast:this.configuration.options.highContrastMode,locale:this.locale,useIceConnection:!1,timezoneOffsetMinutes:this.configuration.options.timezoneOffsetMinutes,sdkType:"web",osName:ft(t),enableOptionalDataCollection:this.configuration.options.enableOptionalDataCollection},n={titleId:this._titleInfo.titleId,systemUpdateGroup:e,settings:i,serverId:"",fallbackRegionNames:this.user.fallbackRegionNames,clientSessionId:this.telemetryContext.getClientSessionId()};return await this.triggerPlayRequest(n)}async sendPlayRequest(e,t){return this.playClient.sendPlayCloud(e,t)}connectionType(){return rt.Tu.Cloud}}class kt extends bt{constructor(e,t,i,n,s,o,r,a,c){super(e,t,i,n,s,o,new wt(i,yt.PersonalConsole,void 0,void 0,rt.Tu.Home),a,c,void 0),r||this.logger.throw("No console id specified",l.ws.InvalidArgument),this.consoleId=r}async startProcessingRequest(){this.logger.info("Creating new remote play session."),this.telemetry.trackEvent(s()({event:d.X.SessionCreating,locale:this.locale,timezoneMinutes:this.configuration.options.timezoneOffsetMinutes},this.telemetryContext.getProps(this.cv)));const e=this.playClient.deviceInformation,t={titleId:"",systemUpdateGroup:"",settings:{nanoVersion:ge(this.streamType),enableTextToSpeech:this.configuration.options.enableNarrator,magnifier:this.configuration.options.enableMagnifier,highContrast:this.configuration.options.highContrastMode,locale:this.locale,useIceConnection:!1,timezoneOffsetMinutes:this.configuration.options.timezoneOffsetMinutes,sdkType:"web",osName:e.isIPadOS&&!e.desktopSiteRequested?"iPadOSDesktopSiteNotRequested":e.osName,enableOptionalDataCollection:this.configuration.options.enableOptionalDataCollection},serverId:this.consoleId,fallbackRegionNames:[],clientSessionId:this.telemetryContext.getClientSessionId()};return await this.triggerPlayRequest(t)}async sendPlayRequest(e,t){return this.playClient.sendPlayHome(e,t)}connectionType(){return rt.Tu.Home}}class At extends bt{constructor(e,t,i,n,s,o,r,a,c){super(e,t,i,n,s,o,new wt(i,yt.ManagedDevkit,void 0,void 0,rt.Tu.ManagedDevkit),r,a,void 0),c||this.logger.throw("No play path specified",l.ws.InvalidArgument),this.path=c}async startProcessingRequest(){this.logger.info("Creating new managed devkit play session.");const e=this.playClient.deviceInformation,t={osName:e.isIPadOS&&!e.desktopSiteRequested?"iPadOSDesktopSiteNotRequested":e.osName};return await this.triggerPlayRequest(t)}async sendPlayRequest(e,t){return this.playClient.sendPlayManagedDevkit(this.path,e,t)}connectionType(){return rt.Tu.ManagedDevkit}}const Pt=e=>e&&"productId"in e&&"title"in e&&"description"in e&&"creator"in e&&"image"in e&&"payload"in e;var Et=i(44256),xt=i(19409);class Mt extends Et.W{constructor(){super("StreamClientLogHandler")}onVerbose(e,...t){this.log(e,xt.LogLevel.Debug,t.join(" "))}onInfo(e,...t){this.log(e,xt.LogLevel.Info,t.join(" "))}onWarning(e,...t){this.log(e,xt.LogLevel.Warn,t.join(" "))}onError(e,...t){this.log(e,xt.LogLevel.Error,t.join(" "))}}Mt.isSupported=Et.W.isSupported;class Dt{constructor(e,t){this.user=e,this.playClient=t,this.user=e,this.playClient=t,this.logger=c.r.Instance}async getAllUserContent(){return this.logger.info("Calling gamestream services for user content info"),this.playClient.getUserContent(this.user)}async deleteUserContent(e,t){return this.logger.info("Calling gamestream services to delete user content info"),this.playClient.deleteUserContent(this.user,e,t)}}var Rt=i(99677);const Ft=JSON.parse('{"webSdkPackageVersion":"10.5.14"}');function Lt(e){return{make:e.vendor,model:e.model,platformType:e.deviceType,sdkType:"web"}}function Nt(e){return{browserName:e.browserName,browserVersion:e.browserVersion}}function Ut(e){var t;return{clientAppId:window.location.host,clientAppType:"browser",clientAppVersion:null===(t=_t.appMetadata)||void 0===t?void 0:t.version,clientSdkVersion:Ft.webSdkPackageVersion,httpEnvironment:"prod",sdkInstallId:e}}function $t(e){return{name:ft(e),ver:e.osVersion,platform:e.deviceType}}class Vt{constructor(e,t){this.sdkInstallId=e,this.deviceInformation=t,this.priority=0,this.intercept=async e=>{const t={env:Ut(this.sdkInstallId)};this.deviceInformation||(this.deviceInformation=new Ce.P6),await this.deviceInformation.updatePlatformSpecificInformation();const i={displayInfo:{dimensions:{heightInPixels:window.outerHeight,widthInPixels:window.outerWidth},pixelDensity:{dpiX:window.devicePixelRatio,dpiY:window.devicePixelRatio}},browser:Nt(this.deviceInformation),hw:Lt(this.deviceInformation),os:$t(this.deviceInformation)},n=(0,u.A)({appInfo:t,dev:i});return o.InterceptedRequest.fromRequest(e,{additionalHeaders:{"X-MS-Device-Info":n}})}}}class Bt{constructor(e){this.onRetryAfterUpdate=e,this.priority=0,this.intercept=async(e,t)=>{if(this.onRetryAfterUpdate&&t.headers.has("Retry-After")){const e=t.headers.get("Retry-After"),i=e?parseInt(e,10):void 0;this.onRetryAfterUpdate(i)}return t}}}class Ot{constructor(e,t=new w.W,i=globalThis.fetch,n=new Ce.P6){this.logger=c.r.Instance,this.endpointSettings=e,this.basicFetch=i,this.cv=t,this.deviceInformation=n;this.playFetch=(0,o.createInterceptedFetch)(this.basicFetch,{request:[new z,new ee(this.endpointSettings.getHeaders()),new W.CorrelationVectorInterceptor((async()=>this.cv.increment().getValue()))],response:[new Q(this.logger)],error:[new Z(this.logger)]}),this.tabFetch=(0,o.createInterceptedFetch)(this.basicFetch,{error:[new Z(this.logger)]})}setSessionCv(e){this.cv=e}async sendPlayCloud(e,t){const i=`${e.endpointSettings.getDomain()}/v5/sessions/cloud/play`,n=(0,o.createInterceptedFetch)(ie(this.playFetch,e),{request:[new Vt(e.endpointSettings.getSdkInstallId(),this.deviceInformation)]});try{const e=await n(i,{method:"POST",body:(0,u.A)(t)}),s=await e.text(),o=JSON.parse(s);return o||this.logger.throw("sendPlayCloud returned invalid json",l.ws.BadConfiguration),o}catch(s){this.throwCaughtError(s,"sendPlayCloud")}}async sendPlayHome(e,t){const i=`${e.endpointSettings.getDomain()}/v5/sessions/home/play`,n=(0,o.createInterceptedFetch)(ie(this.playFetch,e),{request:[new Vt(e.endpointSettings.getSdkInstallId(),this.deviceInformation)]});try{const e=await n(i,{method:"POST",body:(0,u.A)(t)}),s=await e.text(),o=JSON.parse(s);return o||this.logger.throw("sendPlayHome returned invalid json",l.ws.BadConfiguration),o}catch(s){this.throwCaughtError(s,"sendPlayHome")}}async sendPlayManagedDevkit(e,t,i){const n=`${t.endpointSettings.getDomain()}/${e}/play`,s=(0,o.createInterceptedFetch)(ie(this.playFetch,t),{request:[new Vt(t.endpointSettings.getSdkInstallId(),this.deviceInformation)]});try{const e=await s(n,{method:"POST",body:(0,u.A)(i)}),t=await e.text(),o=JSON.parse(t);return o||this.logger.throw("sendPlayManagedDevkit returned invalid json",l.ws.BadConfiguration),o}catch(r){this.throwCaughtError(r,"sendPlayManagedDevkit")}}async getState(e,t,i,n){const s=`${t.getDomain()}/${i}/state`,r=(0,o.createInterceptedFetch)(ie(this.playFetch,e),{response:[new Bt(n.onRetryAfterUpdate)]});try{const e=await r(s,{method:"GET"}),t=await e.text();this.logger.info(`text response from polling of /state: ${t}`);const i=JSON.parse(t);return i||this.logger.throw("getState returned invalid json",l.ws.BadConfiguration),i}catch(a){this.throwCaughtError(a,"getState")}}async sendConnect(e,t,i,n){const s=`${t.getDomain()}/${i}/connect`,o=ie(this.playFetch,e);try{await o(s,{method:"POST",body:(0,u.A)(n)})}catch(r){this.throwCaughtError(r,"sendConnect")}}async getConfiguration(e,t,i){const n=`${t.getDomain()}/${i}/configuration`,s=ie(this.playFetch,e);try{const e=await s(n,{method:"GET"}),t=await e.text(),i=JSON.parse(t);i||this.logger.throw("getConfiguration returned invalid json",l.ws.BadConfiguration);const r=i.clientStreamingConfigOverrides;if(r&&("string"===typeof r||r instanceof String)){let e;try{e=JSON.parse(r)}catch(o){const e=(0,h.g)(o);this.logger.error(`An unexpected error occurred while JSON parsing clientStreamingConfigOverrides - ${e.message}`)}try{vt(e),i.clientStreamingConfigOverrides=e}catch(o){const e=(0,h.g)(o);this.logger.error(`Invalid clientStreamingConfigOverrides specified - ${e.message}`),this.logger.error(`Removing invalid 'clientStreamingConfigOverrides' property from configuration response - ${r}`),i.clientStreamingConfigOverrides=void 0}}return i}catch(r){this.throwCaughtError(r,"getConfiguration")}}async sendSessionFileABug(e,t,i){const n=`${e.endpointSettings.getDomain()}/${t}/fileabug`,s=(0,o.createInterceptedFetch)(ie(this.playFetch,e),{request:[new Vt(e.endpointSettings.getSdkInstallId(),this.deviceInformation)]});try{await s(n,{method:"POST",body:(0,u.A)(i)})}catch(r){this.throwCaughtError(r,"sendSessionFileABug")}}async sendTelemetryEventsViaServices(e,t){const i=`${e.endpointSettings.getDomain()}/v1/client/cte`,n=(0,o.createInterceptedFetch)(ie(this.playFetch,e),{request:[new Vt(e.endpointSettings.getSdkInstallId(),this.deviceInformation)]});try{await n(i,{method:"POST",body:(0,u.A)(t)})}catch(s){this.throwCaughtError(s,"sendTelemetryEventsViaServices")}}async fetchTitleInfosByIds(e,t,i,{version:n}={version:2}){const s=ie(this.playFetch,e);try{const o=await s(`${e.endpointSettings.getDomain()}/v${n}/titles`,{method:"POST",body:JSON.stringify({alternateIds:t,alternateIdType:i})});return await o.json()}catch(o){this.logger.throw("fetchTitleInfoByIds returned invalid json",l.ws.BadConfiguration)}}async enumerateTitles(e,t,i,{version:n}={version:2}){let s=`${e.endpointSettings.getDomain()}/v${n}/titles?mr=${t}`;i&&(s=`${s}&ct=${i}`);const o=ie(this.playFetch,e);try{const e=await o(s,{method:"GET"}),t=await e.text(),i=JSON.parse(t);return i||this.logger.throw("enumerateTitles returned invalid json",l.ws.BadConfiguration),i}catch(r){this.throwCaughtError(r,"enumerateTitles")}}async enumerateMruTitles(e,t,i,{version:n}={version:2}){let s=`${e.endpointSettings.getDomain()}/v${n}/titles/mru?mr=${t}`;i&&(s=`${s}&ct=${i}`);const o=ie(this.playFetch,e);try{const e=await o(s,{method:"GET"}),t=await e.text(),i=JSON.parse(t);return i||this.logger.throw("enumerateMruTitles returned invalid json",l.ws.BadConfiguration),i}catch(r){this.throwCaughtError(r,"enumerateMruTitles")}}async getActiveTitlesForUser(e){const t=`${e.endpointSettings.getDomain()}/v5/sessions/cloud/active`,i=ie(this.playFetch,e);try{const e=await i(t,{method:"GET"}),n=await e.text(),s=JSON.parse(n);return s||this.logger.throw("getActiveTitlesForUser returned invalid json",l.ws.BadConfiguration),s}catch(n){this.throwCaughtError(n,"getActiveTitlesForUser")}}async getTitleWaitTime(e,t){const i=`${e.endpointSettings.getDomain()}/v1/waittime/${t}`,n=ie(this.playFetch,e);try{const e=await n(i,{method:"GET"}),t=await e.text(),s=JSON.parse(t);return s||this.logger.throw("getTitleWaitTime returned invalid json",l.ws.BadConfiguration),s}catch(s){this.throwCaughtError(s,"getTitleWaitTime")}}async enumerateConsoles(e,t,i){let n=`${e.endpointSettings.getDomain()}/v6/servers/home?mr=${t}`;i&&(n=`${n}&ct=${i}`);const s=ie(this.playFetch,e);try{const e=await s(n,{method:"GET"}),t=await e.text(),i=JSON.parse(t);return i||this.logger.throw("enumerateConsoles returned invalid json",l.ws.BadConfiguration),i}catch(o){this.throwCaughtError(o,"enumerateConsoles")}}async deleteSession(e,t,i){const n=`${t.getDomain()}/${i}`,s=ie(this.playFetch,e);try{await s(n,{method:"DELETE"})}catch(o){this.throwCaughtError(o,"deleteSession")}}async sendSessionKeepAlive(e,t,i){const n=`${t.getDomain()}/${i}/keepalive`,s=ie(this.playFetch,e);try{const e=await s(n,{method:"POST"}),t=await e.text(),i=JSON.parse(t);return i||this.logger.throw("sendSessionKeepAlive returned invalid json",l.ws.BadConfiguration),i}catch(o){this.throwCaughtError(o,"sendSessionKeepAlive")}}async sendIce(e,t,i,n){const s=`${t.getDomain()}/${i}/ice`,o=ie(this.playFetch,e);try{await o(s,{method:"POST",body:(0,u.A)(n.Data)})}catch(r){this.throwCaughtError(r,"sendIce")}}async getIce(e,t,i){const n=`${t.getDomain()}/${i}/ice`,s=ie(this.playFetch,e);try{const e=await s(n,{method:"GET"}),t=await e.text();if(this.logger.info(`getIce returned ${t}`),""===t)return null;const i=JSON.parse(t),o=JSON.parse(i.exchangeResponse);return o||this.logger.throw("getIce returned invalid json",l.ws.BadConfiguration),o}catch(o){this.throwCaughtError(o,"getIce")}}async sendSdp(e,t,i,n){const s=`${t.getDomain()}/${i}/sdp`,o=ie(this.playFetch,e);try{await o(s,{method:"POST",body:(0,u.A)(n.Data)})}catch(r){this.throwCaughtError(r,"sendSdp")}}async getSdp(e,t,i){const n=`${t.getDomain()}/${i}/sdp`,s=ie(this.playFetch,e);try{const e=await s(n,{method:"GET"}),t=await e.text();if(this.logger.info(`getSdp returned ${t}`),""===t)return null;const i=JSON.parse(t);return i||this.logger.throw("getSdp returned invalid json",l.ws.BadConfiguration),i.exchangeResponse}catch(o){this.throwCaughtError(o,"getSdp")}}async getTouchAdaptationBundle(e,t,i){const n=`${t.getDomain()}/v1/sessions/tabs/${i}/download?noRedirect=true`,s=ie(this.playFetch,e);try{const e=await s(n,{method:"GET"}),t=await e.text(),i=await this.tabFetch(t,{method:"GET"});return await i.arrayBuffer()}catch(o){this.throwCaughtError(o,"getTouchAdaptationBundle")}}async getUserContent(e){const t=`${e.endpointSettings.getDomain()}/v1/usercontent`,i=ie(this.playFetch,e);try{const e=await i(t,{method:"GET"}),n=await e.text(),s=JSON.parse(n);return s||this.logger.throw("usercontent returned invalid json",l.ws.BadConfiguration),s}catch(n){this.throwCaughtError(n,"usercontent")}}async deleteUserContent(e,t,i){const n=`${e.endpointSettings.getDomain()}/v1/usercontent/${t}/${i}`,s=ie(this.playFetch,e);try{await s(n,{method:"DELETE"})}catch(o){this.throwCaughtError(o,"deleteUserContent")}}async getTitleInputConfigurations(e,t,i){const n=ie(this.playFetch,e);try{const s=await n(`${e.endpointSettings.getDomain()}/v2/titles/inputconfigs`,{method:"POST",body:JSON.stringify({titleIds:t,titleIdType:i})});return await s.json()}catch(s){this.logger.throw("getTitleInputConfigurations returned invalid json",l.ws.BadConfiguration)}}throwCaughtError(e,t){if(e instanceof a.F)this.logger.throw(e.message,e.code);else{const i=(0,h.g)(e);this.logger.throw(`${t} could not complete: ${i.message}`,l.ws.Unexpected)}}}let Ht=0;class Gt{constructor(e){this.logger=e,this.priority=-1,this.intercept=async e=>{const t=e.headers.get(o.HttpHeader.CorrelationVector)||"";this.logger.info(`Http #${Ht} call ${e.method} to ${e.url} with cv:${t}`);const i=s()(s()({},e.metadata),{},{startTime:Date.now(),callCount:Ht}),n=o.InterceptedRequest.fromRequest(e,{metadata:i});return Ht++,n}}}class Kt{constructor(e,t){this.logger=e,this.telemetry=t,this.priority=-1,this.intercept=async(e,t)=>{const i=e.metadata.startTime,n=e.metadata.callCount,s=""+(Date.now()-i),r=e.headers.get(o.HttpHeader.CorrelationVector)||"";return this.logger.info(`Http #${n} completed from ${e.url} with ${t.status} in ${s} Ms with cv:${r}`),this.telemetry.trackEvent({event:d.X.HttpCompleted,cV:r,url:e.url,latencyMs:s,httpMethod:e.method,httpStatus:t.status}),t}}}class qt{constructor(e,t){this.logger=e,this.telemetry=t,this.priority=-1,this.intercept=async(e,t)=>{const i=e.metadata.startTime,n=e.metadata.callCount,s=""+(Date.now()-i),r=e.headers.get(o.HttpHeader.CorrelationVector)||"";if(t instanceof o.HttpError){const i=t.response;this.logger.warning(`Http #${n} failed from ${e.url} with ${i.status} in ${s} Ms with cv:${r}`),this.telemetry.trackEvent({event:d.X.HttpCompleted,cV:r,url:e.url,latencyMs:s,httpMethod:e.method,httpStatus:i.status,errorMessage:t.message})}else this.logger.warning(`Http #${n} failed from ${e.url} with '${t.message}' in ${s} Ms with cv:${r}`),this.telemetry.trackEvent({event:d.X.HttpFailed,cV:r,url:e.url,latencyMs:s,httpMethod:e.method,errorMessage:t.message});throw t}}}class Xt{constructor(e,t){this.user=e,this.playClient=t,this.logger=c.r.Instance}async fetchTitleInfosByIds(e,t,i={version:2}){if(!e.length)return this.logger.warning("fetchTitleInfosByIds received an empty list of ids"),[];const n=await this.playClient.fetchTitleInfosByIds(this.user,e,t,i);return n.results.forEach((e=>{var t;e.details&&(e.details.productId=null===(t=e.details.productId)||void 0===t?void 0:t.toUpperCase())})),n.results}async enumerateTitles(e,t,i={version:2}){const n=await this.playClient.enumerateTitles(this.user,e,t.token,i);return this.logger.info(`enumerated ${n.results.length} titles`),n.results.forEach((e=>{var t;e.details&&(e.details.productId=null===(t=e.details.productId)||void 0===t?void 0:t.toUpperCase())})),n}async enumerateMruTitles(e,t,i={version:2}){const n=await this.playClient.enumerateMruTitles(this.user,e,t.token,i);return n.results.forEach((e=>{var t;e.details&&(e.details.productId=null===(t=e.details.productId)||void 0===t?void 0:t.toUpperCase())})),this.logger.info(`enumerated ${n.results.length} MRU titles`),n}async getActiveTitlesForUser(e){const t=await this.playClient.getActiveTitlesForUser(e);return this.logger.info(`retrieved ${t.length} active titles for user`),t}async getTitleWaitTime(e,t){const i=await this.playClient.getTitleWaitTime(e,t);return this.logger.info(`title wait time: ${i}`),i}async getTitleInputConfigurations(e,t){return e.length?await this.playClient.getTitleInputConfigurations(this.user,e,t):(this.logger.warning("getTitleInputConfigurations received an empty list of ids"),[])}}class _t{get authRoutingService(){var e;return null!==(e=this.configuration.authRoutingService)&&void 0!==e?e:v.AzureFrontDoor}constructor(e,t){var i;this.instanceId=++_t.instances,this.deviceInformation=null!==(i=null===e||void 0===e?void 0:e.deviceInformation)&&void 0!==i?i:new Ce.P6,this.logger=new c.r("StreamClient",`(${this.instanceId})`),this.telemetry=d.H.Instance,this.telemetry.setHandler(null===e||void 0===e?void 0:e.telemetryHandler),null!==e&&void 0!==e&&e.logHandler?c.r.logHandler=null===e||void 0===e?void 0:e.logHandler:Mt.isSupported&&(c.r.logHandler=new Mt),_t.appMetadata=null===e||void 0===e?void 0:e.appMetadata,t?this.cv=t:(this.cv=new w.W,this.logger.warning(`No correlation vector is passed from the client. Used this new cv: ${this.cv.getValue()}`)),e||this.logger.warning("StreamClient was created without any configuration, falling back to defaults"),this.configuration=null!==e&&void 0!==e?e:{httpEnvironment:oe.Default,locale:"en-us"},this.configuration.locale||(this.configuration.locale="en-us"),this.logger.info(`Stream client created using sdk version: ${Ft.webSdkPackageVersion}`),this.logger.info(`Stream client using locale: ${this.configuration.locale}`),this.endpointSettings=new he(this.configuration.httpEnvironment,null===e||void 0===e?void 0:e.sdkInstallId,this.configuration.headers);const n=function(e,t,i,n={}){return n.retryPredicate=ne,(0,o.composeFetchEnhancers)(e,s()({interceptors:{request:[new Gt(t)],response:[new Kt(t,i)],error:[new qt(t,i)]}},n))}((this.configuration.keepAlive,globalThis.fetch),this.logger,this.telemetry);this.playClient=new Ot(this.endpointSettings,this.cv,n,this.deviceInformation),this.authClient=new se(this.cv,n),this.setNewSessionCv(),this.telemetry.trackEvent({event:d.X.SdkInitialized,cV:this.cv.getValue()})}setNewSessionCv(){const e=this.cv.increment().extend();return this.playClient.setSessionCv(e),this.authClient.setSessionCv(e),e}shouldOfferingUseDnsPrefix(e){switch(e){case"publicpreview":case"takehome":case"takehomeweb":case"xgputest":case"xgpubeta":case"xgpuweb":case"xgpuwebf2p":case"xgpu":case"xhome":case"validunittestoffering":case"core":case"xgpuconsole":case"xgpupcapp":case"somerville":case"xgpuks":case"takehomeconsole":return!0;default:return!1}}async login(e,t,i){this.logger.info("Logging in with user token");const n=("string"===typeof i?i:i.id).toLowerCase(),s=this.createAuthEndpointSettings(i),o=Date.now(),r=this.cv.increment();let a;switch(e){case f.ManagedDevkit:a=new S(t,i,r,s);break;case f.XCloud:default:a=new p(t,this.authClient,i,r,s)}try{await a.updateToken(),this.telemetry.trackEvent({event:d.X.AuthCompleted,cV:r.getValue(),success:a.hasToken(),offeringId:n,latencyMs:Date.now()-o})}catch(l){const e=(0,h.g)(l);throw this.telemetry.trackEvent({event:d.X.AuthCompleted,cV:r.getValue(),success:!1,offeringId:n,latencyMs:Date.now()-o,error:e.message}),l}return this.logger.info("Made a user!"),a}deserializeUser(e,t,i){this.logger.info("Deserializing user");const n=this.createAuthEndpointSettings(i),s=this.cv.increment(),o=p.deserialize(e,t,this.authClient,i,s,n);return this.telemetry.trackEvent({event:d.X.AuthHydrated,cV:s.getValue(),offeringId:"string"===typeof i?i:i.id}),this.logger.info("Deserialized a user!"),o}getOfferings(e){return this.authClient.getOfferings(e.token,this.endpointSettings)}getTitleManagerForUser(e){return new Xt(e,this.playClient)}getContentManager(e){return new Dt(e,this.playClient)}getConsolesForUser(e,t,i){return this.playClient.enumerateConsoles(e,t,i)}createCloudSessionRequest(e,t,i,n,s){const o=this.setNewSessionCv();return new It(t,e,o,this.playClient,this.configuration.locale,s,i,n,this.deviceInformation)}createHomeConsoleSessionRequest(e,t,i,n,s){const o=this.setNewSessionCv();return new kt(t,e,o,this.playClient,this.configuration.locale,s,i,n,this.deviceInformation)}createDirectConnectSession(e,t,i,n,s,o,r){const a=(0,Rt.ok)(t,i,o,r),l=this.setNewSessionCv();return new at(e,a,l,s,rt.Tu.Direct,n,new wt(l,yt.PersonalConsole),this.playClient.deviceInformation)}createManagedDevkitConnectSession(e,t,i,n,s){const o=this.setNewSessionCv();return new At(i,t,o,this.playClient,this.configuration.locale,n,s,this.deviceInformation,e.path)}getCorrelationVector(){return this.cv.increment().getValue()}getLogHandler(){return c.r.logHandler}sendTelemetryEventsViaServices(e,t){if(e)return this.playClient.sendTelemetryEventsViaServices(e,t)}getTouchAdaptationBundle(e,t){return this.playClient.getTouchAdaptationBundle(e,e.endpointSettings,t)}isAzureTrafficManagerEligible(e){return["xgpuweb","xgpuwebf2p","takehomeweb"].includes(e.toLowerCase())}createAuthEndpointSettings(e,t=this.authRoutingService){const i=("string"===typeof e?e:e.id).toLowerCase();let n=t;(!i||n===v.AzureTrafficManager&&!1===this.isAzureTrafficManagerEligible(i))&&(n=v.AzureFrontDoor);const s=this.endpointSettings.clone();s.getHeaders().append("X-GSSV-Routing",n===v.AzureTrafficManager?"ATM":"AFD");const o=i&&this.shouldOfferingUseDnsPrefix(i)?i:void 0;return s.setDomain(s.getDomainForAuth(n,o)),s}}var Wt;function zt(e){return"nativeTouch"in e&&"blockedByFamilySafety"in e}function Yt(e){return"supportedInputTypes"in e}function jt(e){if(e){var t;if(zt(e.details))return!0;if(Yt(e.details)&&null!==(t=e.details.supportedInputTypes)&&void 0!==t&&t.includes(Wt.controller))return!0}return!1}function Jt(e){if(e){var t;if(zt(e.details)&&e.details.nativeTouch)return!0;if(Yt(e.details)&&null!==(t=e.details.supportedInputTypes)&&void 0!==t&&t.includes(Wt.nativeTouch))return!0}return!1}function Qt(e){var t;return!!e&&Yt(e.details)&&(null===(t=e.details.supportedInputTypes)||void 0===t?void 0:t.includes(Wt.mouseAndKeyboard))}function Zt(e){var t,i;return(null!==(t=null===e||void 0===e||null===(i=e.details)||void 0===i?void 0:i.supportedTabs)&&void 0!==t?t:[]).length>0}function ei(e){return!!e&&Yt(e.details)&&e.details.supportedInputTypes.includes(Wt.nativeSensor)}_t.instances=0,function(e){e.controller="Controller",e.mouseAndKeyboard="MKB",e.customTouchOverlay="CustomTouchOverlay",e.genericTouch="GenericTouch",e.nativeTouch="NativeTouch",e.nativeSensor="NativeSensor"}(Wt||(Wt={}));const ti={msvideoprocessing:()=>{const e=document.createElement("video");return Ze(e)&&e.msGetVideoProcessingTypes().length>0}},ii=["datachannel","fullscreen","gamepads","lowbandwidth","peerconnection","webaudio","webworkers","msvideoprocessing"];let ni;function si(){return ni||(ni=new Promise(((e,t)=>{ni=i.e(563).then(i.t.bind(i,30278,23)).then((()=>{const{Modernizr:t}=window;if(!t)return void e(void 0);let i;if("function"!==typeof t.addTest){c.r.Instance.warning("Modernizr is missing the addTest API - Manually shimming additional tests"),i=t;for(const e in ti){const t=e;null==Object.getOwnPropertyDescriptor(i,t)&&null==i[t]&&Object.defineProperty(i,t,{get:ti[t]})}}else i=t.addTest(ti);e(i)})).catch((e=>{ni=void 0,t(e)}))})),ni)}const oi=!0;function ri(e,t){oi&&d.H.Instance.trackEvent(s()({event:d.X.UnsupportedBrowserFeature,features:JSON.stringify(e)},ci(t)))}function ai(e){if(!oi)return;const t=ci(e);window.MediaSource&&window.MediaSource.isTypeSupported?(d.H.Instance.trackEvent(s()({event:d.X.MediaSourceSupport,isSupported:"true"},t)),[{name:"AVC1",type:"video/mp4",codecs:"avc1.42c020, avc1.4d001f, avc1.4d002a"},{name:"HVC1",type:"video/mp4",codecs:"hvc1.1.6.L123.B0"},{name:"HEV1",type:"video/mp4",codecs:"hev1.1.6.L123.B0"},{name:"VP9",type:"video/mp4",codecs:"vp09.00.50.08"},{name:"AV1",type:"video/mp4",codecs:"av01.0.31M.08"},{name:"OPUS",type:"audio/webm",codecs:"opus"},{name:"AAC",type:"audio/mp4",codecs:""}].forEach((e=>{let i=`${e.type};`;e.codecs&&(i+=` codecs="${e.codecs}"`),d.H.Instance.trackEvent(s()(s()(s()({event:d.X.MediaSourceCodecSupport},e),t),{},{mime:i,isSupported:JSON.stringify(MediaSource.isTypeSupported(i))}))}))):d.H.Instance.trackEvent(s()({event:d.X.MediaSourceSupport,isSupported:"false"},t))}async function li(e){if(!oi)return!1;let t,i=!0;try{t=await si()}catch(n){c.r.Instance.error("Unable to load Modernizr",n)}return null==t?(c.r.Instance.error(`Unable to determine if ${e} is supported - Modernizr is not in global scope, defaulting to true`),!0):(null!=t[e]?i=t[e]:c.r.Instance.error(`Unable to determine if ${e} is supported - Modernizr returned null, defaulting to true`),i)}function ci(e){return{browser:e.browserName,device:JSON.stringify(e.vendor),version:e.browserVersion}}var di=i(90101)},52468:(e,t,i)=>{i.d(t,{Hd:()=>r,_V:()=>o,bK:()=>a});var n=i(23522),s=i(16556);const o={INSTANTIATE_GAME_STREAM:{START:"@gameStream/INSTANTIATE_GAME_STREAM_START",SUCCESS:"@gameStream/INSTANTIATE_GAME_STREAM_SUCCESS",ERROR:"@gameStream/INSTANTIATE_GAME_STREAM_ERROR"},TEARDOWN_GAME_STREAM:"@gameStream/TEARDOWN_GAME_STREAM"},r=(0,n.vR)(s.H.GameStream,o.INSTANTIATE_GAME_STREAM.START,((...e)=>({params:e})),o.INSTANTIATE_GAME_STREAM.SUCCESS,(e=>({instance:e})),o.INSTANTIATE_GAME_STREAM.ERROR,(e=>({error:e}))),a=(0,n.VP)(s.H.GameStream,o.TEARDOWN_GAME_STREAM,(e=>({instance:e})))},56188:(e,t,i)=>{i.d(t,{F:()=>s});i(97107);var n=i(76753);class s extends Error{constructor(e,t){super(e),this.code=(0,n.JQ)(t),"function"===typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(`GameStreamError: ${t}`).stack,Object.setPrototypeOf(this,s.prototype)}toString(){return`GameStreamError: ${n.ws[this.code]}: ${this.message}`}}},59306:(e,t,i)=>{var n;i.d(t,{P:()=>n}),function(e){e[e.WebRTCV1=0]="WebRTCV1"}(n||(n={}))},70622:(e,t,i)=>{i.d(t,{H:()=>o,X:()=>n});var n,s=i(31622);!function(e){e.AuthCompleted="xCloud.Client.SDK.Auth.Completed",e.AuthHydrated="xCloud.Client.SDK.Auth.Hydrated",e.AuthUserTokenRefreshed="xCloud.Client.SDK.Auth.UserTokenRefreshed",e.GameInviteAccepted="xCloud.Client.SDK.GameInviteAccepted",e.HttpCompleted="xCloud.Client.SDK.HttpRequestCompleted",e.HttpFailed="xCloud.Client.SDK.HttpRequestFailed",e.InputDevice="xCloud.Client.SDK.InputDevice",e.MediaSourceCodecSupport="xCloud.Client.SDK.Browser.MediaSource.Codec.Support",e.MediaSourceSupport="xCloud.Client.SDK.Browser.MediaSource.Support",e.MessageMismatchFieldType="xCloud.Client.SDK.MessageMismatchFieldType",e.MessageMissingField="xCloud.Client.SDK.MessageMissingField",e.MicrophoneEnable="xCloud.Client.SDK.Microphone.Enable",e.MicrophoneDisable="xCloud.Client.SDK.Microphone.Disable",e.NonstandardGamepadConnected="xCloud.Client.SDK.Gamepad.NonstandardConnected",e.SdkError="LogLevel.Error",e.SdkInitialized="xCloud.Client.SDK.Initialized",e.SdkWarning="LogLevel.Warning",e.SensorInitialization="xCloud.Client.SDK.SensorInitialization",e.SessionCancelled="xCloud.Client.SDK.Session.Cancelled",e.SessionConfiguration="xCloud.Client.SDK.Session.Configuration",e.SessionConnect="xCloud.Client.SDK.Session.Connect",e.SessionCreating="xCloud.Client.SDK.Session.Creating",e.SessionDisconnect="xCloud.Client.SDK.Session.Disconnect",e.SessionFailed="xCloud.Client.SDK.Session.Failed",e.SessionInvalidFrameMetadata="xCloud.Client.SDK.Session.InvalidFrameMetadata",e.SessionNetworkQualityIndicatorSummary="xCloud.Client.SDK.Session.NetworkQualityIndicatorSummary",e.SessionReady="xCloud.Client.SDK.Session.Ready",e.SessionReceivedSessionPath="xCloud.Client.SDK.Session.ReceivedSessionPath",e.SessionReconnect="xCloud.Client.SDK.Session.Reconnect",e.SessionRedirected="xCloud.Client.SDK.Session.Redirected",e.SessionShutdown="xCloud.Client.SDK.Session.Shutdown",e.ServerInitiatedDisconnect="xCloud.Client.SDK.StreamServerInitiatedDisconnect",e.ServicesDomainChanged="xCloud.Client.SDK.EndpointSettings.ServicesDomainChanged",e.StateSharePrototypeInitiated="xCloud.Client.SDK.StateShareDevToolInitiated",e.StreamMediaConfiguration="xCloud.Client.SDK.Stream.Media.Configuration",e.StreamStatistics="xCloud.Client.SDK.Stream.Media.Statistics",e.StreamTitleChanged="xCloud.Client.SDK.MicroManager.OnStreamTitleChanged",e.SystemUiCancel="xCloud.Client.SDK.SystemUi.Cancel",e.SystemUiCompleted="xCloud.Client.SDK.SystemUi.Completed",e.SystemUiMalformedResponse="xCloud.Client.SDK.SystemUi.MalformedResponse",e.SystemUiRemoteCancellation="xCloud.Client.SDK.SystemUi.RemoteCancellation",e.SystemUiShow="xCloud.Client.SDK.SystemUi.Show",e.UnknownKeyboardReading="xCloud.Client.SDK.UnknownKeyboardReading",e.UnsupportedBrowserFeature="xCloud.Client.SDK.Browser.UnsupportedFeature",e.VideoConfigurationUpdated="xCloud.Client.SDK.Stream.Media.VideoConfigurationUpdated",e.VideoRestartStatistics="xCloud.Client.SDK.Stream.Media.VideoRestartStatistics",e.VideoRenderBufferExceededCount="xCloud.Client.SDK.Stream.Media.VideoRenderBufferExceededCount",e.WarningForBeingIdle="xCloud.Client.SDK.WarningForBeingIdle"}(n||(n={}));class o{constructor(){}static get Instance(){return this.instance||(this.instance=new o),this.instance}trackEvent(e,t){var i;null===(i=this.telemetryHandler)||void 0===i||i.onTrackEvent(e,t)}setHandler(e){this.telemetryHandler=e}setEnableLightweightTelemetry(e){this.telemetryHandler&&(this.telemetryHandler.setEnableLightweightTelemetry(e),s.r.Instance.info(`LightweightTelemetry Provider enabled = ${e}`))}isLightweightTelemetryEnabled(){var e,t;return null!==(e=null===(t=this.telemetryHandler)||void 0===t?void 0:t.isLightweightTelemetryEnabled())&&void 0!==e&&e}}},74687:(e,t,i)=>{i.d(t,{A:()=>n});i(97107),i(64727);const n=e=>"object"!==typeof e||e instanceof Error?String(e):JSON.stringify(e)},75618:(e,t,i)=>{i.d(t,{c:()=>o});var n=i(57333),s=i(88060);const o=e=>{const{tvSettingsStore:t}=(0,n.A)();return(0,s.eQ)(e,t)}},76203:(e,t,i)=>{i.d(t,{Bf:()=>a,Kg:()=>r,Lm:()=>o,Tn:()=>l,y$:()=>d,yy:()=>h});i(97107),i(87050),i(10568);var n=i(37837),s=i(74687);const o=e=>"boolean"==typeof e;Object.assign(o,{toString:()=>"isBoolean"});const r=e=>"string"===typeof e||e instanceof String;Object.assign(r,{toString:()=>"isString"});const a=e=>"number"===typeof e&&Number.isFinite(e);Object.assign(a,{toString:()=>"isFiniteNumber"});const l=e=>"function"===typeof e;Object.assign(l,{toString:()=>"isFunction"});const c=(e,t)=>{for(const i in e){if(t===e[i])return!0}return!1};function d(e,{name:t="isEnumValue"}={}){return Object.assign(c.bind(null,e),{toString:()=>t})}function h(e,{name:t="validate",ignoreNullish:i=!1,throwErrors:o=!1}={}){return Object.assign((function(r){try{if(!r||"object"!==typeof r||Array.isArray(r))throw new Error(`Value passed into '${t}' was not an Object: ${typeof r}`);for(const n in e){const o=e[n],a=r[n];if((!i||null!=a)&&!o(a)){let e=o.toString();e.length>50&&(e=e.slice(0,50).concat("..."));let i=(0,s.A)(a);throw i.length>50&&(i=i.slice(0,50).concat("...")),new Error(`Value '${i}' of '${n}' for '${t}' was invalid according to method '${e}'`)}}return!0}catch(a){const e=(0,n.g)(a);if(o)throw e;return!1}}),{toString:()=>t})}Object.assign(c,{toString:()=>"isEnumValue"})},76753:(e,t,i)=>{i.d(t,{CW:()=>s,JQ:()=>o,kE:()=>a,ws:()=>n});var n;i(81045),i(55367),i(75604),i(41532),i(32950),i(73599),i(64770),i(62080),i(97012),i(31274),i(29548),i(47342),i(14825),i(92467),i(67497),i(88236),i(47010);!function(e){e[e.Success=0]="Success",e[e.NotReady=-2147024875]="NotReady",e[e.OperationPending=-2147483638]="OperationPending",e[e.Bounds=-2147483637]="Bounds",e[e.IllegalMethodCall=-2147483634]="IllegalMethodCall",e[e.ApplicationExiting=-2147483622]="ApplicationExiting",e[e.NotImplemented=-2147467263]="NotImplemented",e[e.NoInterface=-2147467262]="NoInterface",e[e.InvalidPointer=-2147467261]="InvalidPointer",e[e.Aborted=-2147467260]="Aborted",e[e.Failed=-2147467259]="Failed",e[e.Unexpected=-2147418113]="Unexpected",e[e.IoFailure=-2147316574]="IoFailure",e[e.AccessDenied=-2147024891]="AccessDenied",e[e.InvalidHandle=-2147024890]="InvalidHandle",e[e.OutOfMemory=-2147024882]="OutOfMemory",e[e.Unsupported=-2147024846]="Unsupported",e[e.InvalidArgument=-2147024809]="InvalidArgument",e[e.InsufficientBuffer=-2147024774]="InsufficientBuffer",e[e.InvalidState=-2147019873]="InvalidState",e[e.AbiVersionMismatch=-2147023590]="AbiVersionMismatch",e[e.InvalidLocale=-2147009793]="InvalidLocale",e[e.UnknownString=-2147009863]="UnknownString",e[e.OnlEActionRequired=-2138701812]="OnlEActionRequired",e[e.InvalidJsonString=-2089484281]="InvalidJsonString",e[e.WebEUnexpectedContent=-2089484283]="WebEUnexpectedContent",e[e.BadLength=-2147024872]="BadLength",e[e.ArithmeticOverflow=-2147024362]="ArithmeticOverflow",e[e.NotFound=-2147023728]="NotFound",e[e.FatalApplicationExit=-2147024183]="FatalApplicationExit",e[e.Cancelled=-2147023673]="Cancelled",e[e.NoSuchUser=-2147023579]="NoSuchUser",e[e.BadConfiguration=-2147023286]="BadConfiguration",e[e.ResourceDataNotFound=-2147023084]="ResourceDataNotFound",e[e.JsonValueNotFound=-2089484279]="JsonValueNotFound",e[e.NoNetwork=-2147023674]="NoNetwork",e[e.InternetNameNotResolved=-2147012889]="InternetNameNotResolved",e[e.ServiceSpecificError=-2147023830]="ServiceSpecificError",e[e.Timeout=-2147024638]="Timeout",e[e.SSLException=-2147012841]="SSLException",e[e.AuthUnauthorized=-2145844847]="AuthUnauthorized",e[e.Conflict=-2145844839]="Conflict",e[e.Gone=-2145844838]="Gone",e[e.NoEntitlement=-2143322111]="NoEntitlement",e[e.GamePassExpired=-2143322098]="GamePassExpired",e[e.XboxLiveAccountCurfew=-2146051059]="XboxLiveAccountCurfew",e[e.BlockedByParentalControls=-2117991998]="BlockedByParentalControls",e[e.BlockedByScreenTime=-2136865785]="BlockedByScreenTime",e[e.BlockedByAppTime=-2015297515]="BlockedByAppTime",e[e.AppOutsideCurfew=-2015297516]="AppOutsideCurfew",e[e.TransferTokenMicrosoftAccountUnfamiliarLocation=-2147186433]="TransferTokenMicrosoftAccountUnfamiliarLocation",e[e.TransferTokenMicrosoftAccountProofUp=-2147186613]="TransferTokenMicrosoftAccountProofUp",e[e.SigninCountByDeviceTypeExceeded=-2146051050]="SigninCountByDeviceTypeExceeded",e[e.TitleSinglePointOfPresenceViolated=-2146051042]="TitleSinglePointOfPresenceViolated",e[e.GamePointOfPresenceViolated=-2146051073]="GamePointOfPresenceViolated",e[e.AuthInvalidOffering=-2015756287]="AuthInvalidOffering",e[e.AuthBadToken=-2015756286]="AuthBadToken",e[e.TitleIdInUse=-2015756285]="TitleIdInUse",e[e.InvalidServicesDomain=-2015756284]="InvalidServicesDomain",e[e.UnsupportedMarketOrFlight=-2015756283]="UnsupportedMarketOrFlight",e[e.SigninBlockedByPasswordPrompt=-2015756282]="SigninBlockedByPasswordPrompt",e[e.ConsoleStreamingDisabled=-2015756281]="ConsoleStreamingDisabled",e[e.StreamingVersionNotRecognized=-2015756280]="StreamingVersionNotRecognized",e[e.StreamingVersionObsolete=-2015756279]="StreamingVersionObsolete",e[e.TitleOffline=-2015756278]="TitleOffline",e[e.SessionResumedElsewhere=-2015756277]="SessionResumedElsewhere",e[e.AuthExpiredToken=-2015756276]="AuthExpiredToken",e[e.ServiceInternalError=-2015756275]="ServiceInternalError",e[e.TrialTimeExpired=-2015756273]="TrialTimeExpired",e[e.TrialAccessDenied=-2015756272]="TrialAccessDenied",e[e.ManagedDevkitUnauthorized=-2015756271]="ManagedDevkitUnauthorized",e[e.ManagedDevkitAccessToAccountDenied=-2015756270]="ManagedDevkitAccessToAccountDenied",e[e.ManagedDevkitInvalidRedeemCode=-2015756269]="ManagedDevkitInvalidRedeemCode",e[e.ManagedDevkitAccountDoesNotExist=-2015756268]="ManagedDevkitAccountDoesNotExist",e[e.ManagedDevkitSessionDoesNotExist=-2015756267]="ManagedDevkitSessionDoesNotExist",e[e.ManagedDevkitStreamingSessionDoesNotExist=-2015756266]="ManagedDevkitStreamingSessionDoesNotExist",e[e.ManagedDevkitStreamingSessionNotInExpectedState=-2015756265]="ManagedDevkitStreamingSessionNotInExpectedState",e[e.ManagedDevkitStreamingSessionNoValidPassword=-2015756264]="ManagedDevkitStreamingSessionNoValidPassword",e[e.ManagedDevkitAccessToSessionDenied=-2015756263]="ManagedDevkitAccessToSessionDenied",e[e.Unknown=-1879048193]="Unknown"}(n||(n={}));const s=new Array(n.NoEntitlement,n.TitleIdInUse,n.TitleOffline,n.GamePassExpired,n.XboxLiveAccountCurfew,n.BlockedByParentalControls,n.BlockedByScreenTime,n.BlockedByAppTime,n.TransferTokenMicrosoftAccountUnfamiliarLocation,n.TransferTokenMicrosoftAccountProofUp,n.ServiceSpecificError,n.ServiceInternalError,n.TrialTimeExpired,n.TrialAccessDenied,n.ManagedDevkitUnauthorized,n.ManagedDevkitAccessToAccountDenied,n.ManagedDevkitInvalidRedeemCode,n.ManagedDevkitAccountDoesNotExist,n.ManagedDevkitSessionDoesNotExist,n.ManagedDevkitStreamingSessionDoesNotExist,n.ManagedDevkitStreamingSessionNotInExpectedState,n.ManagedDevkitStreamingSessionNoValidPassword,n.ManagedDevkitAccessToSessionDenied,n.Unknown),o=e=>{if(null==e)return n.Unknown;const t=Number(e);return t in n?t:n.Unknown},r=Object.entries(n).reduce(((e,[t,i])=>("number"!==typeof i||isNaN(i)||e.set(i,t),e)),new Map),a=e=>r.get(e)},78911:(e,t,i)=>{i.d(t,{Ay:()=>c,pA:()=>l});i(93510);var n=i(57361),s=i(37509),o=i(41178),r=i(52468),a=i(16556);const l=Symbol("instance");const c=(0,s.v4G)([a.H.GameStream],new s.sVo({[l]:n.LCE_NOT_REQUESTED}).on(r.Hd.start.getType(),((e,t)=>(0,o.jM)(e,(t=>{t[l]=(0,n.lceFetching)(e[l])})))).on(r.Hd.success.getType(),((e,{instance:t})=>(0,o.jM)(e,(e=>{e[l]=(0,n.lceContent)(t)})))).on(r.Hd.error.getType(),((e,{error:t})=>(0,o.jM)(e,(i=>{i[l]=(0,n.lceError)(t,e[l])})))).on(r.bK.getType(),((e,t)=>(0,o.jM)(e,(e=>{e[l]=n.LCE_NOT_REQUESTED})))).build())},79406:(e,t,i)=>{i.d(t,{F:()=>r,w:()=>n});var n,s=i(76203);!function(e){e.Stereo="Stereo",e.Mono="Mono"}(n||(n={}));const o={enableMicrophone:s.Lm,gameVolumeLevel:s.Bf,useHardwareAudioDecoding:s.Lm,audioMode:(0,s.y$)(n,{name:"isAudioMode"}),enableGameChat:s.Lm,outputDeviceSinkId:s.Kg},r=(0,s.yy)(o,{name:"validateAudioConfiguration",ignoreNullish:!0,throwErrors:!0})},82361:(e,t,i)=>{var n;function s(e,t=0){let i=0;e.DPadUp&&(i|=n.DPadUp),e.DPadDown&&(i|=n.DPadDown),e.DPadLeft&&(i|=n.DPadLeft),e.DPadRight&&(i|=n.DPadRight),e.Menu&&(i|=n.Menu),e.View&&(i|=n.View),e.LeftThumb&&(i|=n.LeftThumb),e.RightThumb&&(i|=n.RightThumb),e.LeftShoulder&&(i|=n.LeftShoulder),e.RightShoulder&&(i|=n.RightShoulder),e.Nexus&&(i|=n.Nexus),e.A&&(i|=n.A),e.B&&(i|=n.B),e.X&&(i|=n.X),e.Y&&(i|=n.Y),e.LeftTrigger&&(i|=n.LeftTrigger),e.RightTrigger&&(i|=n.RightTrigger);let s=Math.hypot(e.LeftThumbXAxis,e.LeftThumbYAxis),o=s<=t;return o||(i|=n.LeftThumbXAxis,i|=n.LeftThumbYAxis),s=Math.hypot(e.RightThumbXAxis,e.RightThumbYAxis),o=s<=t,o||(i|=n.RightThumbXAxis,i|=n.RightThumbYAxis),i}i.d(t,{J:()=>n,Z:()=>s}),function(e){e[e.None=0]="None",e[e.DPadUp=1]="DPadUp",e[e.DPadDown=2]="DPadDown",e[e.DPadLeft=4]="DPadLeft",e[e.DPadRight=8]="DPadRight",e[e.Menu=16]="Menu",e[e.View=32]="View",e[e.LeftThumb=64]="LeftThumb",e[e.RightThumb=128]="RightThumb",e[e.LeftShoulder=256]="LeftShoulder",e[e.RightShoulder=512]="RightShoulder",e[e.Nexus=1024]="Nexus",e[e.Misc=2048]="Misc",e[e.A=4096]="A",e[e.B=8192]="B",e[e.X=16384]="X",e[e.Y=32768]="Y",e[e.LeftTrigger=65536]="LeftTrigger",e[e.RightTrigger=131072]="RightTrigger",e[e.LeftThumbXAxis=262144]="LeftThumbXAxis",e[e.LeftThumbYAxis=524288]="LeftThumbYAxis",e[e.RightThumbXAxis=1048576]="RightThumbXAxis",e[e.RightThumbYAxis=2097152]="RightThumbYAxis"}(n||(n={}))},84048:(e,t,i)=>{function n(e){return"getCurrentLogArray"in e}i.d(t,{k:()=>n})},90101:(e,t,i)=>{var n;i.d(t,{L:()=>n}),function(e){e.DecodePerformance="DecodePerformance",e.Jitter="Jitter",e.PacketLoss="PacketLoss",e.Ping="Ping"}(n||(n={}))},90507:(e,t,i)=>{i.d(t,{W:()=>r});var n=i(76753),s=i(31622);const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";class r{constructor(e,t){if(this.value=0,this.logger=s.r.Instance,e){const i=e.split(".");this.vector=t?i[0]:e}else this.vector=r.makeBase()}static makeBase(){let e="";for(let t=0;t<22;t++)e+=o.charAt(Math.floor(64*Math.random()));return e}getValue(){return`${this.vector}.${this.value}`}getBase(){return this.vector.split(".")[0]}increment(){return this.value++,this}extend(){return this.vector.length+2>=127&&this.logger.throw("Correlation vector is too long!",n.ws.BadConfiguration),new r(this.getValue())}}},97406:(e,t,i)=>{i.d(t,{$B:()=>s,Cv:()=>C,Fg:()=>A,Lh:()=>m,NP:()=>P,Qs:()=>v,RE:()=>b,SE:()=>d,Sl:()=>l,TZ:()=>a,VU:()=>c,W8:()=>h,WT:()=>g,Yu:()=>T,iz:()=>r,mb:()=>n,ot:()=>k,pY:()=>u,pu:()=>E,qb:()=>y,sl:()=>I,t:()=>S,yB:()=>p,yy:()=>f});i(69375),i(10785),i(78357),i(46196),i(50821),i(36554),i(68472),i(41696),i(81045),i(45950),i(75604),i(41532),i(32950),i(73599),i(64770),i(62080),i(97012),i(31274),i(29548),i(47342),i(14825),i(92467),i(67497),i(88236),i(4793),i(17216),i(66653),i(77706),i(45023),i(14972),i(12991),i(47010);var n,s,o=i(82361);!function(e){e[e.IntervalTimer=0]="IntervalTimer",e[e.IntervalWorkerThread=1]="IntervalWorkerThread"}(n||(n={})),function(e){e[e.None=0]="None",e[e.Metadata=1]="Metadata",e[e.GamepadReport=2]="GamepadReport",e[e.PointerReport=4]="PointerReport",e[e.ClientMetadata=8]="ClientMetadata",e[e.ServerMetadata=16]="ServerMetadata",e[e.Mouse=32]="Mouse",e[e.Keyboard=64]="Keyboard",e[e.Vibration=128]="Vibration",e[e.SensorReport=256]="SensorReport",e[e.UnreliableInputReport=512]="UnreliableInputReport",e[e.UnreliableInputAck=1024]="UnreliableInputAck"}(s||(s={}));const r={GamepadIndex:0,A:0,B:0,X:0,Y:0,LeftShoulder:0,RightShoulder:0,LeftTrigger:0,RightTrigger:0,View:0,Menu:0,LeftThumb:0,RightThumb:0,DPadUp:0,DPadDown:0,DPadLeft:0,DPadRight:0,Nexus:0,LeftThumbXAxis:0,LeftThumbYAxis:0,RightThumbXAxis:0,RightThumbYAxis:0,PhysicalPhysicality:0,VirtualPhysicality:0,Dirty:!1,Virtual:!1},a=1,l=6;var c,d,h,u,g;!function(e){e[e.FourMotorRumble=0]="FourMotorRumble"}(c||(c={})),function(e){e.None="relative",e.Arrow="default",e.Hand="pointer",e.Ibeam="text"}(d||(d={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(h||(h={})),function(e){e[e.Pixels=0]="Pixels",e[e.Line=1]="Line",e[e.Page=2]="Page"}(u||(u={})),function(e){e[e.Unknown=0]="Unknown",e[e.Unreliable=1]="Unreliable",e[e.Approximate=2]="Approximate",e[e.Accurate=3]="Accurate"}(g||(g={}));const m={accelerationX:0,accelerationY:0,accelerationZ:0,accelerationTimestamp:0,angularVelocityX:0,angularVelocityY:0,angularVelocityZ:0,angularVelocityTimestamp:0,magneticFieldX:0,magneticFieldY:0,magneticFieldZ:0,magneticFieldTimestamp:0,orientationW:0,orientationX:0,orientationY:0,orientationZ:0,orientationTimestamp:0,accelerationAccuracy:g.Unknown,angularVelocityAccuracy:g.Unknown,magneticFieldAccuracy:g.Unknown,orientationAccuracy:g.Unknown};class p{constructor(){this.discriminator=0}markStateChange(e=1){this.discriminator+=e}isStateChanged(e){return this.discriminator!==e.discriminator}}var S,v;!function(e){e[e.DpadUp=0]="DpadUp",e[e.DpadDown=1]="DpadDown",e[e.DpadLeft=2]="DpadLeft",e[e.DpadRight=3]="DpadRight",e[e.Menu=4]="Menu",e[e.View=5]="View",e[e.LeftThumb=6]="LeftThumb",e[e.RightThumb=7]="RightThumb",e[e.LeftShoulder=8]="LeftShoulder",e[e.RightShoulder=9]="RightShoulder",e[e.Nexus=10]="Nexus",e[e.Share=11]="Share",e[e.A=12]="A",e[e.B=13]="B",e[e.X=14]="X",e[e.Y=15]="Y",e[e.EnumLength=16]="EnumLength"}(S||(S={}));class f extends p{constructor(){super(),this.gamepadId=0,this.transitionCount=new Uint8Array(S.EnumLength),this.triggerLeft=0,this.triggerRight=0,this.thumbLX=0,this.thumbLY=0,this.thumbRX=0,this.thumbRY=0,this.physicalPhysicality=o.J.None,this.virtualPhysicality=o.J.None}isEqual(e){for(let t=0;t<S.EnumLength;t++)if(this.transitionCount[t]!=e.transitionCount[t])return!1;return this.triggerLeft===e.triggerLeft&&this.triggerRight===e.triggerRight&&this.thumbLX===e.thumbLX&&this.thumbLY===e.thumbLY&&this.thumbRX===e.thumbRX&&this.thumbRY===e.thumbRY&&this.physicalPhysicality===e.physicalPhysicality&&this.virtualPhysicality===e.virtualPhysicality}copyFrom(e){this.discriminator=e.discriminator;for(let t=0;t<S.EnumLength;t++)this.transitionCount[t]=e.transitionCount[t];this.triggerLeft=e.triggerLeft,this.triggerRight=e.triggerRight,this.thumbLX=e.thumbLX,this.thumbLY=e.thumbLY,this.thumbRX=e.thumbRX,this.thumbRY=e.thumbRY,this.physicalPhysicality=e.physicalPhysicality,this.virtualPhysicality=e.virtualPhysicality}}!function(e){e[e.PointerUpDown=0]="PointerUpDown",e[e.PointerMove=1]="PointerMove",e[e.EnumLength=2]="EnumLength"}(v||(v={}));class y extends p{constructor(){super(),this.pointerId=0,this.pointerStateCountByStateType=new Uint8Array(v.EnumLength),this.x=0,this.y=0,this.pressure=0,this.twist=0,this.width=0,this.height=0}isPointerUp(){return this.pointerStateCountByStateType[v.PointerUpDown]%2===0}isEqual(e){for(let t=0;t<v.EnumLength;t++)if(this.pointerStateCountByStateType[t]!==e.pointerStateCountByStateType[t])return!1;return this.pointerId===e.pointerId&&this.x===e.x&&this.y===e.y&&this.pressure===e.pressure&&this.twist===e.twist&&this.width===e.width&&this.height===e.height&&this.clientWidth===e.clientWidth&&this.clientHeight===e.clientHeight}copyFrom(e){this.discriminator=e.discriminator;for(let t=0;t<v.EnumLength;t++)this.pointerStateCountByStateType[t]=e.pointerStateCountByStateType[t];this.pointerId=e.pointerId,this.x=e.x,this.y=e.y,this.pressure=e.pressure,this.twist=e.twist,this.width=e.width,this.height=e.height,this.clientWidth=e.clientWidth,this.clientHeight=e.clientHeight}}const w=256;class C extends p{constructor(){super(),this.transitionCount=new Uint8Array(w)}isKeyDown(e){return!(e>=w||e<0)&&this.transitionCount[e]%2===1}isEqual(e){for(let t=0;t<w;t++)if(this.transitionCount[t]!==e.transitionCount[t])return!1;return!0}copyFrom(e){this.discriminator=e.discriminator;for(let t=0;t<w;t++)this.transitionCount[t]=e.transitionCount[t]}}class T{constructor(){this.changedKeys=new Map}}var b,I;!function(e){e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Middle=4]="Middle",e[e.XButton1=8]="XButton1",e[e.XButton2=16]="XButton2"}(b||(b={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Middle=2]="Middle",e[e.XButton1=3]="XButton1",e[e.XButton2=4]="XButton2",e[e.ButtonCount=8]="ButtonCount"}(I||(I={}));class k extends p{constructor(){super(),this.transitionCount=new Uint8Array(I.ButtonCount),this.x=0,this.y=0,this.wheelX=0,this.wheelY=0,this.type=h.Relative}isButtonDown(e){return!(e>=I.ButtonCount||e<0)&&this.transitionCount[e]%2===1}isEqual(e){for(let t=0;t<I.ButtonCount;t++)if(this.transitionCount[t]!==e.transitionCount[t])return!1;return this.x===e.x&&this.y===e.y&&this.wheelX===e.wheelX&&this.wheelY===e.wheelY&&this.type===e.type}copyFrom(e){this.discriminator=e.discriminator;for(let t=0;t<I.ButtonCount;t++)this.transitionCount[t]=e.transitionCount[t];this.x=e.x,this.y=e.y,this.wheelX=e.wheelX,this.wheelY=e.wheelY,this.type=e.type}}class A{constructor(){this.changedGamepads=new Array,this.changedPointers=new Array}isEmpty(){return 0===this.changedGamepads.length&&0===this.changedPointers.length&&void 0===this.changedKeyboard&&void 0===this.changedMouse}}class P{constructor(e){this.frameId=e,this.gamepad=new f,this.pointers=new Array,this.keyboard=new C,this.mouse=new k}calculateChanges(e){const t=new A;this.gamepad.isStateChanged(e.gamepad)||!this.gamepad.isEqual(e.gamepad)?t.changedGamepads=[this.gamepad]:t.changedGamepads=new Array;for(const i of this.pointers){const n=e.pointers.find((e=>e.pointerId===i.pointerId));void 0!==n&&!n.isStateChanged(i)&&n.isEqual(i)||t.changedPointers.push(i)}if(this.keyboard.isStateChanged(e.keyboard)||!this.keyboard.isEqual(e.keyboard)){const i=new T;for(let t=0;t<w;t++)this.keyboard.transitionCount[t]!==e.keyboard.transitionCount[t]&&i.changedKeys.set(t,this.keyboard.transitionCount[t]);t.changedKeyboard=i}else t.changedKeyboard=void 0;return this.mouse.isStateChanged(e.mouse)||!this.mouse.isEqual(e.mouse)?t.changedMouse=this.mouse:t.changedMouse=void 0,t}isStateChanged(e){let t=!1;if(e.gamepad.discriminator!==this.gamepad.discriminator||e.mouse.discriminator!==this.mouse.discriminator||e.keyboard.discriminator!==this.keyboard.discriminator||e.pointers.length!==this.pointers.length)t=!0;else for(const i of this.pointers){const n=e.pointers.find((e=>e.pointerId===i.pointerId));if(void 0===n||i.discriminator!==n.discriminator){t=!0;break}}return t}copyFrom(e){for(this.frameId=e.frameId,this.gamepad.copyFrom(e.gamepad);this.pointers.length<e.pointers.length;)this.pointers.push(new y);for(let t=0;t<e.pointers.length;t++)this.pointers[t].copyFrom(e.pointers[t]);this.pointers.length=e.pointers.length,this.keyboard.copyFrom(e.keyboard),this.mouse.copyFrom(e.mouse)}}const E={KeyA:4,KeyB:5,KeyC:6,KeyD:7,KeyE:8,KeyF:9,KeyG:10,KeyH:11,KeyI:12,KeyJ:13,KeyK:14,KeyL:15,KeyM:16,KeyN:17,KeyO:18,KeyP:19,KeyQ:20,KeyR:21,KeyS:22,KeyT:23,KeyU:24,KeyV:25,KeyW:26,KeyX:27,KeyY:28,KeyZ:29,Digit1:30,Digit2:31,Digit3:32,Digit4:33,Digit5:34,Digit6:35,Digit7:36,Digit8:37,Digit9:38,Digit0:39,Enter:40,Escape:41,Backspace:42,Tab:43,Space:44,Minus:45,Equal:46,BracketLeft:47,BracketRight:48,Backslash:49,Semicolon:51,Quote:52,Backquote:53,Comma:54,Period:55,Slash:56,CapsLock:57,F1:58,F2:59,F3:60,F4:61,F5:62,F6:63,F7:64,F8:65,F9:66,F10:67,F11:68,F12:69,ScrollLock:71,Pause:72,Insert:73,Home:74,PageUp:75,Delete:76,End:77,PageDown:78,ArrowRight:79,ArrowLeft:80,ArrowDown:81,ArrowUp:82,NumLock:83,NumpadDivide:84,NumpadMultiply:85,NumpadSubtract:86,NumpadAdd:87,NumpadEnter:88,Numpad1:89,Numpad2:90,Numpad3:91,Numpad4:92,Numpad5:93,Numpad6:94,Numpad7:95,Numpad8:96,Numpad9:97,Numpad0:98,NumpadDecimal:99,ControlLeft:224,ShiftLeft:225,AltLeft:226,MetaLeft:227,ControlRight:228,ShiftRight:229,AltRight:230,MetaRight:231}},99677:(e,t,i)=>{function n(e){var t;return 0===e.ipV4Port?e.ipV4Address:`${e.ipV4Address}:${e.ipV4Port}${null!==(t=e.uriPathAndQuery)&&void 0!==t?t:""}`}function s(e){var t;return 0===e.ipV6Port?e.ipV6Address:`${e.ipV6Address}:${e.ipV6Port}${null!==(t=e.uriPathAndQuery)&&void 0!==t?t:""}`}function o(e,t,i,n){const s=e.lastIndexOf(":"),o=e.lastIndexOf("]"),r=-1!=o;let a="",l=0,c="",d=0;return-1===s||r&&s<o||s===e.length-1?r?d=9002:l=9002:r?d=Number(e.substring(s+1)):l=Number(e.substring(s+1)),r?c=e.substring(0,o+1):a=-1===s?e:e.substring(0,s),{ipV4Address:a,ipV4Port:l,ipV6Address:c,ipV6Port:d,srtp:{key:t},uriPathAndQuery:i,stunServerAddresses:n}}i.d(t,{C3:()=>s,Ix:()=>n,ok:()=>o})}}]);